function GetXmlHttp(){var xmlhttp=null;if(!xmlhttp&&typeof XMLHttpRequest!='undefined'){xmlhttp=new XMLHttpRequest();return xmlhttp;}if((xmlhttp==null||xmlhttp==false)&&BrowserTools.IsInternetExplorer()){var xmlhttp=null;/*@cc_on @*//*@if(@_jscript_version>=5)try{xmlhttp=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){try{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");}catch(E){xmlhttp=false;}}@end @*/}return xmlhttp;}function GetXmlHttpIE6ActiveXScript(){return null;}function MetafuseAjaxPostBackObject(){this.EnableDebug=false;this.CallBackQueue=new Array();this.WaitingForActionTimeoutElement=null;this.WaitingForActionAlertElement=null;this.WaitingForActionStartTime=null;this.WaitingForActionAlertTitle="Please Wait...";this.WaitingForActionAlertText="Waiting for a response from the server for a previous action before sending the next action.<p>This message will be dismissed when all actions have completed.</p>";this.WaitingForActionTimeoutTitle="Incomplete Actions...";this.WaitingForActionTimeoutText="There may be a connectivity problem with your browser.<p>You should reload the current page, and verify your internet connection before proceeding.</p>";this.WaitingForActionMaxTimeMilliseconds=10000;this.WaitingForActionRetryMilliseconds=100;this.WaitingForActionShowAlertMilliseconds=4000;};MetafuseAjaxPostBackObject.prototype.DoAjaxPostSimple=MetafuseAjaxPostBackObject_DoAjaxPostSimple;function MetafuseAjaxPostBackObject_DoAjaxPostSimple(eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingNearHTML,includeVeil,blockOtherCallBacks,metafuseAjaxPostBackObjectServerResponse){this.DoAjaxPostComplex(eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingNearHTML,includeVeil,blockOtherCallBacks,metafuseAjaxPostBackObjectServerResponse,null,true,true,null);};MetafuseAjaxPostBackObject.prototype.DoAjaxPostBack=MetafuseAjaxPostBackObject_DoAjaxPostBack;function MetafuseAjaxPostBackObject_DoAjaxPostBack(eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingNearHTML,includeVeil,blockOtherCallBacks,metafuseAjaxPostBackObjectServerResponse){this.DoAjaxPostComplex(eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingNearHTML,includeVeil,blockOtherCallBacks,metafuseAjaxPostBackObjectServerResponse,null,false,false,null);};MetafuseAjaxPostBackObject.prototype.DoAjaxPostComplex=MetafuseAjaxPostBackObject_DoAjaxPostComplex;function MetafuseAjaxPostBackObject_DoAjaxPostComplex(eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingNearHTML,includeVeil,blockOtherCallBacks,metafuseAjaxPostBackObjectServerResponse,additionalNameValueParametersEncoded,excludeViewState,excludeAllFormElements,elementNamesToSendArray){this.DoAjaxPostOrRemotePostComplex(null,eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingNearHTML,includeVeil,blockOtherCallBacks,metafuseAjaxPostBackObjectServerResponse,additionalNameValueParametersEncoded,excludeViewState,excludeAllFormElements,elementNamesToSendArray);}MetafuseAjaxPostBackObject.prototype.DoAjaxRemotePost=MetafuseAjaxPostBackObject_DoAjaxRemotePost;function MetafuseAjaxPostBackObject_DoAjaxRemotePost(urlToInvoke,elementNamesToSendArray,additionalNameValueParametersEncoded,eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingNearHTML,includeVeil){this.DoAjaxPostOrRemotePostComplex(urlToInvoke,eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingNearHTML,includeVeil,false,null,additionalNameValueParametersEncoded,true,true,elementNamesToSendArray);};MetafuseAjaxPostBackObject.prototype.DoAjaxRemotePostComplex=MetafuseAjaxPostBackObject_DoAjaxRemotePostComplex;function MetafuseAjaxPostBackObject_DoAjaxRemotePostComplex(urlToInvoke,elementNamesToSendArray,additionalNameValueParametersEncoded,eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingNearHTML,includeVeil,blockOtherCallBacks,metafuseAjaxPostBackObjectServerResponse,excludeViewState,excludeAllFormElements){this.DoAjaxPostOrRemotePostComplex(urlToInvoke,eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingNearHTML,includeVeil,blockOtherCallBacks,metafuseAjaxPostBackObjectServerResponse,additionalNameValueParametersEncoded,excludeViewState,excludeAllFormElements,elementNamesToSendArray);}MetafuseAjaxPostBackObject.prototype.DoAjaxPostOrRemotePostComplex=MetafuseAjaxPostBackObject_DoAjaxPostOrRemotePostComplex;function MetafuseAjaxPostBackObject_DoAjaxPostOrRemotePostComplex(urlToInvoke,eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingNearHTML,includeVeil,blockOtherCallBacks,metafuseAjaxPostBackObjectServerResponse,additionalNameValueParametersEncoded,excludeViewState,excludeAllFormElements,elementNamesToSendArray){if(UITools.EnableDebugOutput==true){this.EnableDebug=true;}if(causesValidation){if(typeof(Page_ClientValidate)=='function'){Page_ClientValidate();}if(typeof(Page_IsValid)!='undefined'&&!Page_IsValid){return;}}var multipleCheckboxHash=new Object();var theData='';var payload=new Array();var theform=document.forms[0];var thePage="";if(urlToInvoke!=null&&urlToInvoke!=""){thePage=urlToInvoke;}else{thePage=window.location.pathname+window.location.search;}var sobj=new String(thePage);if(sobj.lastIndexOf("/")==(sobj.length-1)){thePage=thePage+"default.aspx";};if(!eventTarget){eventTarget='';}if(!eventArgument){eventArgument='';}var timestamp=new Date().valueOf();var viewstate="";payload[0]='__AJAXPOSTBACKTS='+timestamp;payload[1]='__EVENTTARGET='+escape(eventTarget);payload[2]='__EVENTARGUMENT='+encodeURIComponent(eventArgument);if(!excludeViewState){viewstate+='__VIEWSTATE='+escape(theform.__VIEWSTATE.value).replace(new RegExp('\\+','g'),'%2b')+'&';}var eName='';if(!excludeAllFormElements||elementNamesToSendArray!=null){var radioElements=new Object();var loopLength=theform.elements.length;if(excludeAllFormElements){loopLength=0;if(isString(elementNamesToSendArray)){elementNamesToSendArray=elementNamesToSendArray.replace(' ','');elementNamesToSendArray=elementNamesToSendArray.split(',');}loopLength=elementNamesToSendArray.length;}for(var i=0;i<loopLength;i++){var element=null;if(!excludeAllFormElements){element=theform.elements[i];}else{element=GetElementById(elementNamesToSendArray[i]);}if(element!=null){eName=element.name;if(eName&&eName!=''){if(eName=='__EVENTTARGET'||eName=='__EVENTARGUMENT'||eName=='__VIEWSTATE'){}else{var process=true;if(element.type=="radio"){if(radioElements[eName]!=null){process=false;}else{radioElements[eName]=true;}}if(process){var getFormElementValue=true;var elementValue="";if(element.type=="checkbox"){var checkboxElement=theform[eName];if(checkboxElement.length&&checkboxElement.length>1){if(element.checked){var checkboxValueArray=multipleCheckboxHash[eName];if(checkboxValueArray==null){checkboxValueArray=new Array();multipleCheckboxHash[eName]=checkboxValueArray;}checkboxValueArray[checkboxValueArray.length]=element.value;}}else{elementValue=FormTools.GetFormElementValue(element);}}else{elementValue=FormTools.GetFormElementValue(element);}if(elementValue!=""&&element.type=="select-multiple"){var multipleSelectValues=elementValue.split(",");for(var z=0;z<multipleSelectValues.length;z++){payload[payload.length]=encodeURIComponent(eName)+'='+encodeURIComponent(multipleSelectValues[z]);}}else if(elementValue!=""||(element.type!="checkbox"&&(element.type!="text"||element.attributes["skip-empty"]==null))){payload[payload.length]=encodeURIComponent(eName)+'='+encodeURIComponent(elementValue);}}}}}}}if(multipleCheckboxHash!=null){for(var key in multipleCheckboxHash){var cbArray=multipleCheckboxHash[key];payload[payload.length]=encodeURIComponent(key)+'='+encodeURIComponent(cbArray.join(','));}}if(additionalNameValueParametersEncoded){theData+="&"+additionalNameValueParametersEncoded;}if(viewstate!=null&&viewstate!=""){payload[payload.length]=viewstate;}theData=payload.join('&');var serverResponse=null;if(metafuseAjaxPostBackObjectServerResponse==null){serverResponse=new MetafuseAjaxPostBackObjectServerResponse();}else{serverResponse=metafuseAjaxPostBackObjectServerResponse;}if(elementToShowProcessingNear){serverResponse.ElementToShowProcessingNear=elementToShowProcessingNear;}if(processingNearHTML!=null&&processingNearHTML!=""){serverResponse.ProcessingNearHTML=processingNearHTML;}serverResponse.IncludeVeil=includeVeil;serverResponse.Url=thePage;serverResponse.PostData=theData;serverResponse.BlockOtherCalls=blockOtherCallBacks;if(serverResponse.XmlHttp){var self=this;setTimeout(function(){self.InvokeAjaxCall(serverResponse)},0);}else{alert("Unable to create an XmlHttp object.  Please be sure you are using (IE 5.5+, FireFox 1.1+, or Safari 1.1+) and for IE7+ you have \"Enable Native XMLHTTP Support on\" or for IE6 and below that your ActiveX security setting, \"Script ActiveX controls marked safe for scripting,\" is enabled.");}};MetafuseAjaxPostBackObject.prototype.InvokeAjaxCall=function(serverResponse){if(!serverResponse.Url){return;}if(serverResponse.BlockOtherCalls||this.CallBackQueue.length>0){if(!serverResponse.InCallBackWaitQueue){serverResponse.InCallBackWaitQueue=true;this.CallBackQueue[this.CallBackQueue.length]=serverResponse.CallBackID;}var activeCallBackID=this.CallBackQueue[0];if(activeCallBackID!=serverResponse.CallBackID){var timer=new Date();if(!this.WaitingForActionStartTime){this.WaitingForActionStartTime=timer;}var waitingTime=timer-this.WaitingForActionStartTime;if(!this.WaitingForActionAlertElement&&waitingTime>this.WaitingForActionShowAlertMilliseconds){this.WaitingForActionAlertElement=UITools.ShowAlertBox(this.WaitingForActionAlertText,this.WaitingForActionAlertTitle,false,null,"fade",null,"disabled");}if(waitingTime>this.WaitingForActionMaxTimeMilliseconds){if(this.WaitingForActionTimeoutElement==null){this.WaitingForActionTimeoutElement=UITools.ShowAlertBox(this.WaitingForActionTimeoutText,this.WaitingForActionTimeoutTitle,false,null,"fade");}}var self=this;setTimeout(function(){self.InvokeAjaxCall(serverResponse)},this.WaitingForActionRetryMilliseconds);return;}if(!serverResponse.BlockOtherCalls){this.DeQueueCallBackQueue(serverResponse);}}if((this.WaitingForActionAlertElement||this.WaitingForActionTimeoutElement)&&this.CallBackQueue.length==0){UITools.HideAlertBox(this.WaitingForActionAlertElement);UITools.HideAlertBox(this.WaitingForActionTimeoutElement);this.WaitingForActionAlertElement=null;this.WaitingForActionStartTime=null;}serverResponse.ShowProcessingMessage();var oThis=this;serverResponse.XmlHttp.open(serverResponse.Method,serverResponse.Url,true);serverResponse.XmlHttp.onreadystatechange=function(){oThis.ReadyStateChange(serverResponse);};serverResponse.XmlHttp.setRequestHeader('Content-Type','application/x-www-form-urlencoded');serverResponse.XmlHttp.send(serverResponse.PostData);};MetafuseAjaxPostBackObject.prototype.ReadyStateChange=function(serverResponse){if(this.EnableDebug==true){serverResponse.EnableDebug=this.EnableDebug;}if(serverResponse.XmlHttp.readyState==1){serverResponse.StartDateTime=new Date();window.status="AJAX call connecting...";serverResponse.OnLoading(serverResponse);}else if(serverResponse.XmlHttp.readyState==2){if(!serverResponse.StartDateTime){serverResponse.StartDateTime=new Date();}window.status="AJAX call loaded...";serverResponse.OnLoaded(serverResponse);}else if(serverResponse.XmlHttp.readyState==3){window.status="AJAX call processing...";serverResponse.OnInteractive(serverResponse);}else if(serverResponse.XmlHttp.readyState==4){window.status="AJAX call received...";if(serverResponse.XmlHttp.status==0){serverResponse.OnAbort(serverResponse);serverResponse.HideProcessingMessage();this.DeQueueCallBackQueue(serverResponse);}else if((serverResponse.XmlHttp.status==200&&(serverResponse.XmlHttp.statusText=="OK"||serverResponse.XmlHttp.statusText=="")&&serverResponse.XmlHttp.responseText.substring(0,16)!="<!--ERRORPAGE-->")||(BrowserTools.IsSafari()&&serverResponse.XmlHttp.responseText==null)){var responseText=serverResponse.XmlHttp.responseText;if(responseText!=null&&responseText.length>0){var isValidString=responseText.substring(0,1);serverResponse.ResponseText=responseText.substring(1,responseText.length-1);if(isValidString=="0"){serverResponse.IsValid=false;}}serverResponse.OnBeforeExecuteSuccessfulResponse(serverResponse);serverResponse.OnExecuteSuccessfulResponse(serverResponse);var endTime=new Date;serverResponse.EndDateTime=endTime;var deltaTime="";if(serverResponse.StartDateTime){try{deltaTime=((endTime.getTime()-serverResponse.StartDateTime.getTime())/1000);}catch(ex){}}if(deltaTime!=""){window.status="AJAX call complete - "+deltaTime.toString()+" secs";}else{window.status="AJAX call complete";}serverResponse.HideProcessingMessage();this.DeQueueCallBackQueue(serverResponse);serverResponse.OnAfterExecuteSuccessfulResponse(serverResponse);if(jQueryMobileInputRefreshEnabled){$('select').selectmenu('refresh');$("input[type='checkbox']").checkboxradio('refresh');}}else{serverResponse.OnBeforeProcessErrorMessage(serverResponse);serverResponse.OnProcessErrorMessage(serverResponse);window.status="AJAX call error";serverResponse.HideProcessingMessage();this.DeQueueCallBackQueue(serverResponse);serverResponse.OnAfterProcessErrorMessage(serverResponse);}}};MetafuseAjaxPostBackObject.prototype.DeQueueCallBackQueue=function(serverResponse){for(var i=0;i<this.CallBackQueue.length;i++){if(serverResponse.CallBackID==this.CallBackQueue[i]){this.CallBackQueue.splice(i,1);break;}}if(this.CallBackQueue.length==0){if(this.WaitingForActionTimeoutElement){UITools.HideAlertBox(this.WaitingForActionTimeoutElement);}this.WaitingForActionTimeoutElement=null;if(this.WaitingForActionAlertElement){UITools.HideAlertBox(this.WaitingForActionAlertElement);}this.WaitingForActionStartTime=null;this.WaitingForActionAlertElement=null;}};var Ajax=new MetafuseAjaxPostBackObject();function MetafuseAjaxPostBackObjectServerResponse(){this.CallBackTS=new Date().valueOf();this.CallBackID=NewGuid()+this.CallBackTS;this.StartDateTime;this.EndDateTime;this.XmlHttp=GetXmlHttp();this.ElementToShowProcessingNear=null;this.ProcessingDiv=null;this.ProcessingIFrame=null;this.ProcessingNearHTML="Processing...";this.IncludeVeil=false;this.ResponseText=null;this.IsValid=true;this.EnableDebug=false;this.Method="POST";this.Url=null;this.PostData=null;this.BlockOtherCalls=false;this.InCallBackWaitQueue=false;};MetafuseAjaxPostBackObjectServerResponse.prototype.AbortPostBack=function(metafuseAjaxPostBackObjectServerResponse){if(metafuseAjaxPostBackObjectServerResponse.XmlHttp){metafuseAjaxPostBackObjectServerResponse.XmlHttp.abort();}metafuseAjaxPostBackObjectServerResponse.OnAbort(metafuseAjaxPostBackObjectServerResponse);};MetafuseAjaxPostBackObjectServerResponse.prototype.OnLoading=function(metafuseAjaxPostBackObjectServerResponse){};MetafuseAjaxPostBackObjectServerResponse.prototype.OnLoaded=function(metafuseAjaxPostBackObjectServerResponse){};MetafuseAjaxPostBackObjectServerResponse.prototype.OnInteractive=function(metafuseAjaxPostBackObjectServerResponse){};MetafuseAjaxPostBackObjectServerResponse.prototype.OnAbort=function(metafuseAjaxPostBackObjectServerResponse){};MetafuseAjaxPostBackObjectServerResponse.prototype.OnBeforeExecuteSuccessfulResponse=function(metafuseAjaxPostBackObjectServerResponse){};MetafuseAjaxPostBackObjectServerResponse.prototype.OnExecuteSuccessfulResponse=function(metafuseAjaxPostBackObjectServerResponse){if(this.EnableDebug==true){if(metafuseAjaxPostBackObjectServerResponse.ResponseText!=null){var textBoxId="textBoxOutputProcessId_"+NewGuid();var appendString="<div style=\"width:100%;\">Response Received: "+new Date().toString()+" : Below :<br/><textarea id=\""+textBoxId+"\" style=\"width:100%;background:#ffffff;\" rows=\"10\">"+metafuseAjaxPostBackObjectServerResponse.ResponseText+"</textarea><br/><a href=\"javascript:\" onclick=\"eval(FormTools.GetFormElementValue('"+textBoxId+"'));\">Re-Execute Contents</a></div>";UITools.InsertHTML(appendString);}else{UITools.InsertHTML("<div><p/>Response Received: "+new Date().toString()+" : No Response</p></div> ");}}try{var s=metafuseAjaxPostBackObjectServerResponse.ResponseText;eval(s);}catch(e){if(UITools.IsDevelopmentMode||(window['pi']!==undefined&&window['pi'].IsDevelopmentMode)){throw e;}else{var xmlHttp=GetXmlHttp();var errorPage=Root+'/error/javascript-ajax';var error="";try{error="NAME: "+e.name+" DESC: "+e.message;if(e.message!=e.description){error+=" ADDTL: "+e.description;}if(e.lineNumber){error+=" LINE: "+e.lineNumber;}}catch(eo){}var errorObj=new Object();errorObj["Url"]=ReturnUrl;errorObj["Error"]=error;errorObj["ResponseText"]=metafuseAjaxPostBackObjectServerResponse.ResponseText;if(pi){var key="AjaxJSError";errorPage+="?url="+encodeURIComponent(ReturnUrl);pi.UI.LocalStorage.Set(key,JSON.stringify(errorObj),60);window.location.href=errorPage;}else{var params=new Object();params["Url"]=ReturnUrl;params["Error"]=error;params["ResponseText"]=metafuseAjaxPostBackObjectServerResponse.ResponseText;FormTools.WindowOpenWithPost(errorPage,params,null,null);}}}};MetafuseAjaxPostBackObjectServerResponse.prototype.OnAfterExecuteSuccessfulResponse=function(metafuseAjaxPostBackObjectServerResponse){};MetafuseAjaxPostBackObjectServerResponse.prototype.OnBeforeProcessErrorMessage=function(metafuseAjaxPostBackObjectServerResponse){};MetafuseAjaxPostBackObjectServerResponse.prototype.OnProcessErrorMessage=function(metafuseAjaxPostBackObjectServerResponse){if(this.EnableDebug&&metafuseAjaxPostBackObjectServerResponse.XmlHttp.responseText.substring(0,16)!="<!--ERRORPAGE-->"&&metafuseAjaxPostBackObjectServerResponse.XmlHttp.responseText.substring(0,22)!="<!--VALIDATEREQUEST-->"){InsertHTML("<div>Error:<br/>"+metafuseAjaxPostBackObjectServerResponse.XmlHttp.responseText+"</div>");}else{if(metafuseAjaxPostBackObjectServerResponse.XmlHttp.responseText.substring(0,22)=="<!--VALIDATEREQUEST-->"){document.location.href=Root+"/Site/Errors/ValidateRequest.aspx";}else if(metafuseAjaxPostBackObjectServerResponse.XmlHttp.responseText.substring(0,16)=="<!--ERRORPAGE-->"){document.location.href=Root+"/Site/Errors/500.aspx";}else{metafuseAjaxPostBackObjectServerResponse.ProcessingDiv=null;metafuseAjaxPostBackObjectServerResponse.ProcessingIFrame=null;UITools.UpdateInnerHTML(document.forms[0],metafuseAjaxPostBackObjectServerResponse.XmlHttp.responseText);}}};MetafuseAjaxPostBackObjectServerResponse.prototype.OnAfterProcessErrorMessage=function(metafuseAjaxPostBackObjectServerResponse){};MetafuseAjaxPostBackObjectServerResponse.prototype.ShowProcessingMessage=MetafuseAjaxPostBackObjectServerResponse_ShowProcessingMessage;function MetafuseAjaxPostBackObjectServerResponse_ShowProcessingMessage(){if(this.ElementToShowProcessingNear){if(isString(this.ElementToShowProcessingNear)){this.ElementToShowProcessingNear=GetElementById(this.ElementToShowProcessingNear);}if(this.ElementToShowProcessingNear){var x=UITools.GetPageXCoordinate(this.ElementToShowProcessingNear);var y=UITools.GetPageYCoordinate(this.ElementToShowProcessingNear);this.ProcessingDiv=this.CreateProcessingDiv(this.CallBackTS,this.ProcessingNearHTML);UITools.ShowAtXY(x,y,this.ProcessingDiv,this.IncludeVeil,"fade");}}};MetafuseAjaxPostBackObjectServerResponse.prototype.HideProcessingMessage=MetafuseAjaxPostBackObjectServerResponse_HideProcessingMessage;function MetafuseAjaxPostBackObjectServerResponse_HideProcessingMessage(){if(this.ProcessingDiv!=null){var div=GetElementById(this.ProcessingDiv);if(div){var iframe=UITools.GetElementShim(div);UITools.HideDivAndIFrame(div);if(div.parentNode){div.parentNode.removeChild(div);}if(iframe!=null){iframe.parentNode.removeChild(iframe);}}}};MetafuseAjaxPostBackObjectServerResponse.prototype.CreateProcessingDiv=MetafuseAjaxPostBackObjectServerResponse_CreateProcessingDiv;function MetafuseAjaxPostBackObjectServerResponse_CreateProcessingDiv(timestamp,processingNearHTML){if(processingNearHTML==null||processingNearHTML==""){processingNearHTML="Processing...";}var processingDivName="ajaxObjectProcessingDiv_"+timestamp;var divHTML="<div id=\""+processingDivName+"\" class=\"AjaxLoadingDiv\" style=\"position: absolute; z-index: 30000; display:none;\">"+"</div>";InsertHTML(divHTML);return GetElementById(processingDivName);};function MAPBB(eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingHTML,includeVeil,blockOtherCallBacks,onBeforeAjaxPostBackCall,metafuseTableToSave,onAfterAjaxPostBackCall){var keepGoing=true;if(onBeforeAjaxPostBackCall){keepGoing=onBeforeAjaxPostBackCall();}if(keepGoing){if(metafuseTableToSave){metafuseTableToSave.SerializeUpdateXml();}var pbr=new MetafuseAjaxPostBackObjectServerResponse();if(onAfterAjaxPostBackCall){pbr.OnAfterExecuteSuccessfulResponse=onAfterAjaxPostBackCall;}Ajax.DoAjaxPostBack(eventTarget,eventArgument,causesValidation,elementToShowProcessingNear,processingHTML,includeVeil,blockOtherCallBacks,pbr);}};