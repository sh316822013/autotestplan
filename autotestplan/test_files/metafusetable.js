function MetafuseTable(elementId,uniqueId,nonUniqueId){this.ElementId=elementId;this.ClientID=elementId;this.UniqueId=uniqueId;this.NonUniqueId=nonUniqueId;this.ObjectId=elementId+"l";this.ElementIdLeftPaneTable=this.ClientID+"_ss_l";this.ElementIdLeftPaneTableHeader=this.ClientID+"_ss_lh";this.ElementIdRightPaneTableHeader=this.ClientID+"_ss_rh";this.SplitScreenRightTableClientID=this.ClientID+"_ss_table";this.ObjectsById=new Object();this.DisableAjaxPostBackOnExpandCollapseAfterChildrenLoaded=false;this.ChildrenPreLoadedLoadedForCollapsedNodes=false;this.RowAdditionalRelatedIdSuffixes=null;this.RowAdditionalRelatedIdSuffixesToHighlight=null;this.RowObjectTypes=null;this.ReceivedExpandCollapseMetafuseTable=null;this.ReceivedTableHtml=null;this.ContextMenus=null;this.OnBeforeShowContextMenuForRow=function(metafuseTable,contextMenu,localEvent,rowId){return true;};this.IsBusy=false;this.OnAfterReplaceRows=function(metafuseTableUpdate){};this.RowIdCurrentlyMoving=null;this.OnBeforeRowMoveDrop=function(rowObject,rowObjectDropOn,metafuseTableDroppedOn,otherElementDroppedOn){return true;};this.OnAfterRowMoveDropPerformMove=function(rowObject,rowObjectDropOn,isChild){};this.RowMoveDropAdditionalMetafuseTablesToMonitor=null;this.RowMoveDropAdditionalElementsToMonitor=null;this.RowIdContextMenu=null;this.FormDefinition=null;this.ObjectsDeleted=new Object();this.ObjectsUpdated=new Object();this.ObjectsCreated=new Object();this.OnUnloadMessage="There are unsaved changes on the form.  Click \"OK\" to have the changes saved or \"Cancel\" to cancel the changes made to the form.";this.EnableOnAddRowObject=false;this.EnableOnUpdateRowObject=false;this.EnableOnRemoveRowObject=false;this.EnableOnAfterSetFormDataAjax=false;this.EnableOnAddRowObjectCausesValidation=false;this.EnableOnUpdateRowObjectCausesValidation=false;this.EnableOnRemoveRowObjectCausesValidation=false;this.EnableSerializeXmlListOnAddRowObject=false;this.EnableSerializeXmlListOnUpdateRowObject=false;this.EnableSerializeXmlListOnRemoveRowObject=false;this.EnableRowMoveDrop=false;this.EnableOnRowMoveDrop=false;this.RowNameValueIndex=-1;this.RowNameCellIndex=-1;this.ExpandCollapseCellIndex=-1;this.OnAfterGetRowName=function(name){return name;};this.OnAfterDeleteObject=function(metafuseTable,id){};this.RowMoveDropDetermineIfChildrenAllowed=function(row){if(this.IsTree==true){return true;}else{return false;}};this.DisableCellAutoToolTipOnHover=false;};function MetafuseTable_GetMetafuseTableObject(elementId){return MetafuseTable_GetJSObject(elementId);};MetafuseTable.prototype.ExpandAll=MetafuseTable_ExpandAll;MetafuseTable.prototype.CollapseAll=MetafuseTable_CollapseAll;MetafuseTable.prototype.SaveTable=MetafuseTable_SaveTable;MetafuseTable.prototype.OnUnload=MetafuseTable_OnUnload;MetafuseTable.prototype.ClearMetafuseTable=MetafuseTable_ClearMetafuseTable;function MetafuseTable_ClearMetafuseTable(){for(var key in this.ObjectsById){var ao=this.ObjectsById[key];var row=GetElementById(ao.Id);var rows=MetafuseTable_GetRowAndRelated(ao.Id);for(var i=0;i<rows.length;i++){var r=rows[i];$(r).remove();}}this.ObjectsById=new Object();this.ObjectsDeleted=new Object();this.ObjectsUpdated=new Object();this.ObjectsCreated=new Object();FormTools.Set(this.ElementId+"_Changes","");};MetafuseTable.prototype.EO=MetafuseTable_Edit;MetafuseTable.prototype.EditObject=MetafuseTable_Edit;function MetafuseTable_Edit(element){return MetafuseTableFormDefinition_EditObject(element);};function MetafuseTable_GetFormRow(element){var table=MetafuseTable_GetTableMain(element);if(table){var formRow=GetElementById(UITools.GetPIAttr(table,"form-row-id"));if(!formRow){var f=$(table).children("tbody").children("tr[class=*='DataListInlineRowEditForm']");if(f&&f.length>0){formRow=f[0];}}return formRow;}return null;};MetafuseTable.prototype.DO=MetafuseTable_Delete;MetafuseTable.prototype.DeleteObject=MetafuseTable_Delete;function MetafuseTable_Delete(element,id,confirmMessage,skipConfirm){element=GetElementById(element);var row=MetafuseTable_GetRowMainFromElement(element);var table=MetafuseTable_GetTableMain(row);if(MetafuseTable_IsBusy(table)){return;}if(id==null||id==""){id=UITools.GetPIAttr(row,"id");}var ajaxObjectDeleting=this.ObjectsById[id];if(id!=""){var disableDelete=UITools.GetPIAttr(row,"dd");if(disableDelete=="1"){var n=MetafuseTable_GetRowName(row);if(n==null||n==""){n="the item";}var msg=UITools.GetPIAttr(table,"permission-denied-delete-message");if(msg==""){msg="You do not have permission to delete <b>$RowName</b>";}msg=msg.replace(/\$RowName/g,n);UITools.ShowAlertBox(msg);return false;}if(!skipConfirm&&UITools.GetPIAttr(table,"disable-confirm-delete")=="1"){skipConfirm=true;}if(skipConfirm){MetafuseTable_DeleteInvoke(row);}else{var cd=UITools.GetPIAttr(table,"delete-confirm-message");if(cd==""){}var name=MetafuseTable_GetRowName(id);if(confirmMessage==null||confirmMessage==""){confirmMessage=UITools.GetPIAttr(table,"delete-confirm-message");}if(confirmMessage==null||confirmMessage==""){confirmMessage="Are you sure you want to delete the row <b>$RowName?</b><br/><br/>Once the row <b>$RowName</b> is deleted it cannot be recovered.";}confirmMessage=confirmMessage.replace(/\$RowName/g,name);var confirmDelete="MetafuseTable_DeleteInvoke('"+row.id+"');";UITools.ShowAlertBox(confirmMessage,"",false,null,null,confirmDelete);return false;}}return false;};function MetafuseTable_DeleteInvoke(row,isRecursive,isRecursiveConfirmed){var row=MetafuseTable_GetRowMainFromElement(row);if(row==null){return false;}var id=UITools.GetPIAttr(row,"id");var table=MetafuseTable_GetTableMain(row);var tableObj=MetafuseTable_GetJSObject(table);if(MetafuseTable_IsBusy(table)){return;}if(!isRecursiveConfirmed){var confRecursive=UITools.GetPIAttr(table,"delete-confirm-recursive");if(confRecursive!=""){var hasChildren=false;var rows=MetafuseTable_GetRowAndRelatedAndChildren(row);for(var i=0;i<rows.length;i++){var r=rows[i];var childId=UITools.GetPIAttr(r,"id");if(childId!=""&&childId!=id){hasChildren=true;break;}}if(!hasChildren&&UITools.GetPIAttr(row,"cl")=="0"&&UITools.GetPIAttr(row,"expand-collapse")=="1"){hasChildren=true;}if(hasChildren){var deleteRecursive="MetafuseTable_DeleteInvoke('"+row.id+"',true,true);";var deleteTopLevel="MetafuseTable_DeleteInvoke('"+row.id+"',false,true);";var deleteConfirmRecursiveButton=UITools.GetPIAttr(table,"delete-confirm-recursive-btn-all");var deleteConfirmParentOnlyButton=UITools.GetPIAttr(table,"delete-confirm-recursive-btn-parent-only");if(deleteConfirmRecursiveButton==""){deleteConfirmRecursiveButton="Delete Parent & Children";}if(deleteConfirmParentOnlyButton==""){deleteConfirmParentOnlyButton="Delete Parent Only";}UITools.ShowAlertBox(confRecursive,"",false,null,null,deleteRecursive,deleteConfirmRecursiveButton,deleteTopLevel,deleteConfirmParentOnlyButton);return;}}}if(isRecursiveConfirmed&&!isRecursive&&(UITools.GetPIAttr(row,"cl")=="0"||UITools.GetPIAttr(row,"c")=="1")&&UITools.GetPIAttr(row,"expand-collapse")=="1"){tableObj.ExpandCollapseObject(row,null,null,true);return;}if(UITools.GetPIAttr(table,"enable-row-delete-ajax")=="1"){var serverResponse=new MetafuseAjaxPostBackObjectServerResponse();var self=tableObj;serverResponse.OnAfterExecuteSuccessfulResponse=function(serverResponse){if(this.IsValid){self.DeleteObjectRecursivelyPerformDelete(row.id,isRecursive);}UITools.SetPIAttr(table,"busy","");};if(tableObj.EnableSerializeXmlListOnRemoveRowObject){tableObj.SerializeUpdateXml();}var command="REMOVERECURSIVE:";if(!isRecursive){command="REMOVE:";}var validate=false;if(UITools.GetPIAttr(table,"validate-delete-row")=="1"){validate=true;}UITools.SetPIAttr(table,"busy","1");Ajax.DoAjaxPostBack(MetafuseTable_GetTableUniqueID(table),command+id,validate,row,"",false,true,serverResponse);}else{tableObj.DeleteObjectRecursivelyPerformDelete(row.id,isRecursive);if(tableObj.EnableSerializeXmlListOnRemoveRowObject){tableObj.SerializeUpdateXml();}UITools.SetPIAttr(table,"busy","");}return;};MetafuseTable.prototype.DeleteObjectRecursivelyPerformDelete=MetafuseTable_DeleteObjectRecursivelyPerformDelete;function MetafuseTable_DeleteObjectRecursivelyPerformDelete(element,isRecursive){var row=MetafuseTable_GetRowMainFromElement(element);var table=MetafuseTable_GetTableMain(row);var jsObj=MetafuseTable_GetJSObject(table);if(!row){return;}var id=UITools.GetPIAttr(row,"id");var idParent=UITools.GetPIAttr(row,"id-parent");var rRelAndChild=MetafuseTable_GetRowAndRelatedAndChildren(row);var lastParentCollapsed=false;for(var i=0;i<rRelAndChild.length;i++){var r=rRelAndChild[i];var rSS=MetafuseTable_GetRowSplitScreenFromElement(r);var objectToDelete=null;var piID=UITools.GetPIAttr(r,"id");var relID=UITools.GetPIAttr(r,"id-related");if(isRecursive||piID==id||relID==id){if(r.id!=""){objectToDelete=jsObj.ObjectsById[r.id];}if(objectToDelete){objectToDelete.IsObjectDeleted=true;if(objectToDelete.IsObjectCreated){delete jsObj.ObjectsCreated[objectToDelete.Id];}else{delete jsObj.ObjectsUpdated[objectToDelete.Id];jsObj.ObjectsDeleted[objectToDelete.Id]=objectToDelete;}}$(r).remove();if(rSS){$(rSS).remove();}if(objectToDelete&&this.FormDefinition!=null){jsObj.FormDefinition.OnAfterDeleteFormData(this.FormDefinition,objectToDelete);}}else{var p=UITools.GetPIAttr(r,"id-parent");if(p!=idParent){UITools.SetPIAttr(r,"id-parent",idParent);}var depth=MathTools.ParseFloat(UITools.GetPIAttr(r,"depth"));depth=depth-1;if(depth<0){depth=0;}UITools.SetPIAttr(r,"depth",depth);if(lastParentCollapsed){r.style.display="none";}else{r.style.display="";}MetafuseTable_UpdateExpandCollapseCellPadding(r);if(rSS){if(lastParentCollapsed){rSS.style.display="none";}else{rSS.style.display="";}UITools.SetPIAttr(rSS,"depth",depth);MetafuseTable_UpdateExpandCollapseCellPadding(rSS);}}if(piID!=""){if(UITools.GetPIAttr(r,"c")=="1"){lastParentCollapsed=true;}else{lastParentCollapsed=false;}}}var onAfterDeleteObject=UITools.GetPIAttr(table,"javascript-after-delete-row");if(onAfterDeleteObject!=""){Utils.ExecuteFunctionByName(onAfterDeleteObject,window,row);}return false;};function MetafuseTable_RowMoveDropPerformMove(rowId,rowDropOnId,rows,rowInsertAfterId,isChild){var row=GetElementById(rowId);var rowDropOn=GetElementById(rowDropOnId);var rowAfter=GetElementById(rowInsertAfterId);var table=MetafuseTable_GetTableMain(row);if(row&&rowDropOn){row=GetElementById(row.id);rowDropOn=GetElementById(rowDropOn.id);rowAfter=GetElementById(rowAfter.id);}var rowAfterSS=MetafuseTable_GetRowSplitScreenFromElement(rowAfter);if(row&&rowDropOn){var depthRowMove=MathTools.ParseFloat(UITools.GetPIAttr(row,"depth"));var depthRowDropOn=MathTools.ParseFloat(UITools.GetPIAttr(rowDropOn,"depth"));var depthString=UITools.GetPIAttr(row,"depth-before-last-replace-row");if(depthString!=null&&depthString!=""){depthRowMove=MathTools.ParseFloat(depthString);}var depthString=UITools.GetPIAttr(rowDropOn,"depth-before-last-replace-row");if(depthString!=null&&depthString!=""){depthRowDropOn=MathTools.ParseFloat(depthString);}if(rows==null){rows=MetafuseTable_GetRowAndRelatedAndChildren(row);}var depthToAdd=depthRowDropOn-depthRowMove;var hideAfterAdd=false;var removeAfterAdd=false;if(isChild){depthToAdd=depthToAdd+1;if(UITools.GetPIAttr(rowDropOn,"c")=="1"){hideAfterAdd=true;if(UITools.GetPIAttr(rowDropOn,"cl")=="0"){removeAfterAdd=true;}}}for(var i=0;i<rows.length;i++){var r=rows[i];r=GetElementById(r.id);var rSS=null;if(rowAfterSS){rSS=MetafuseTable_GetRowSplitScreenFromElement(r);}if(removeAfterAdd){$(r).remove();if(rSS){$(rSS).remove();}}else{var depth=MathTools.ParseFloat(UITools.GetPIAttr(r,"depth"));depthString=UITools.GetPIAttr(r,"depth-before-last-replace-row");if(depthString!=null&&depthString!=""){depth=MathTools.ParseFloat(depthString);}var newDepth=depth+depthToAdd;UITools.SetPIAttr(r,"depth",newDepth);UITools.SetPIAttr(r,"depth-before-last-replace-row","");$(r).insertAfter(rowAfter);rowAfter=r;if(hideAfterAdd){r.style.display="none";}if(rowAfterSS){UITools.SetPIAttr(rSS,"depth",newDepth);UITools.SetPIAttr(rSS,"depth-before-last-replace-row","");$(rSS).insertAfter(rowAfterSS);rowAfterSS=rSS;if(hideAfterAdd){rSS.style.display="none";}}MetafuseTable_UpdateExpandCollapseCellPadding(r);}}UITools.SetPIAttr(row,"depth-before-last-replace-row","");UITools.SetPIAttr(rowDropOn,"depth-before-last-replace-row","");var afterPerformMove=UITools.GetPIAttr(table,"javascript-after-row-move");if(afterPerformMove!=""){Utils.ExecuteFunctionByName(afterPerformMove,window,row,rowDropOn,isChild);}}return;};MetafuseTable.prototype.RowMoveDropServerSideConfirm=MetafuseTable_RowMoveDropServerSideConfirm;function MetafuseTable_RowMoveDropServerSideConfirm(rowId,rowDropOnId,otherElementDroppedOnId,confirmMessage){if(!rowId){rowId="";}if(!rowDropOnId){rowDropOnId="";}if(!otherElementDroppedOnId){otherElementDroppedOnId="";}var dropAction="MetafuseTable_RowMoveDrop('"+rowId+"','"+rowDropOnId+"','"+otherElementDroppedOnId+"', true);";UITools.ShowAlertBox(confirmMessage,"",false,null,null,dropAction);};MetafuseTable.prototype.RowMoveDrop=MetafuseTable_RowMoveDrop;function MetafuseTable_RowMoveDrop(row,rowDropOn,otherElementDroppedOn,serverSideConfirmed){row=GetElementById(row);if(row==null){return;}var table=MetafuseTable_GetTableMain(row);rowDropOn=GetElementById(rowDropOn);var otherElementDroppedOnId="";var serverSideConfirmedString="false";otherElementDroppedOn=GetElementById(otherElementDroppedOn);if(otherElementDroppedOn){otherElementDroppedOnId=otherElementDroppedOn.id;}var rowId=row.id;var rowDropOnId="";if(rowDropOn){rowDropOnId=rowDropOn.id;if(UITools.GetPIAttr(rowDropOn,"disable-row-drop")=="1"){return;}}var onBeforeRowMoveDrop=UITools.GetPIAttr(table,"javascript-on-before-row-move-drop");if(onBeforeRowMoveDrop==""||Utils.ExecuteFunctionByName(onBeforeRowMoveDrop,window,row,rowDropOn,otherElementDroppedOn)==true){if((rowDropOnId!=""&&rowId!=rowDropOnId)||otherElementDroppedOn){var isChild=false;var determineChild=false;var confirmChildSibling=UITools.GetPIAttr(table,"row-move-drop-confirm-child-sibling");if(rowDropOn!=null&&confirmChildSibling!=""&&UITools.GetPIAttr(rowDropOn,"expand-collapse")=="1"){var addAsChildText=UITools.GetPIAttr(table,"row-move-drop-confirm-child-button-text");var addAsSiblingText=UITools.GetPIAttr(table,"row-move-drop-confirm-sibling-button-text");if(addAsChildText==""){addAsChildText="Add as Child";}if(addAsSiblingText==""){addAsSiblingText="Add As Sibling";}var n=MetafuseTable_GetRowName(row);var nd=MetafuseTable_GetRowName(rowDropOn);confirmChildSibling=confirmChildSibling.replace(/\$RowNameDropOn/g,nd);confirmChildSibling=confirmChildSibling.replace(/\$RowName/g,n);var addAsChildCode="MetafuseTable_RowMoveDropInvoke('"+rowId+"','"+rowDropOnId+"','"+otherElementDroppedOnId+"',"+serverSideConfirmedString+",true);";var addAsSiblingCode="MetafuseTable_RowMoveDropInvoke('"+rowId+"','"+rowDropOnId+"','"+otherElementDroppedOnId+"',"+serverSideConfirmedString+",false);";UITools.ShowAlertBox(confirmChildSibling,"",false,null,null,addAsChildCode,addAsChildText,addAsSiblingCode,addAsSiblingText);return;}else{if(UITools.GetPIAttr(rowDropOn,"expand-collapse")=="1"){isChild=true;}}MetafuseTable_RowMoveDropInvoke(rowId,rowDropOnId,otherElementDroppedOn,serverSideConfirmed,isChild);return;}}};MetafuseTable.prototype.RowMoveDropInvoke=MetafuseTable_RowMoveDropInvoke;function MetafuseTable_RowMoveDropInvoke(row,rowDropOn,otherElementDroppedOn,serverSideConfirmed,isChild){row=GetElementById(row);rowDropOn=GetElementById(rowDropOn);var table=MetafuseTable_GetTableMain(row);var rows=MetafuseTable_GetRowAndRelatedAndChildren(row);var rowAfter=rowDropOn;var relateds;if(isChild){relateds=MetafuseTable_GetRowAndRelated(rowAfter);}else{relateds=MetafuseTable_GetRowAndRelatedAndChildren(rowAfter);}if(relateds!=null&&relateds.length>1){rowAfter=relateds[relateds.length-1];}if(UITools.GetPIAttr(table,"enable-drag-drop-row-ajax")=="1"){if(MetafuseTable_IsBusy(table)){return false;}var tableDroppedOn=MetafuseTable_GetTableMain(rowDropOn);var rowId=row.id;var rowDropOnId=rowDropOn.id;var rowType=UITools.GetPIAttr(row,"type");var serverResponse=new MetafuseAjaxPostBackObjectServerResponse();serverResponse.OnAfterExecuteSuccessfulResponse=function(serverResponse){if(this.IsValid){if(rowDropOn!=null&&table==tableDroppedOn){MetafuseTable_RowMoveDropPerformMove(row.id,rowDropOn.id,rows,rowAfter.id,isChild);}}UITools.SetPIAttr(table,"busy","");};showProcessingMessageId="";var eventArgument='ROWDROP:RowId='+rowId+'&IsChild='+isChild;if(rowType!=null&&rowType!=""){eventArgument+="&RowType="+rowType;}if(rowDropOn!=null){var rowDropOnType=UITools.GetPIAttr(rowDropOn,"type");eventArgument+='&RowDropOnId='+rowDropOnId;showProcessingMessageId=rowDropOn.id;if(rowDropOnType!=null&&rowDropOnType!=""){eventArgument+="&RowDropOnType="+rowDropOnType;}var dropOnDepth=MathTools.ParseFloat(UITools.GetPIAttr(rowDropOn,"depth"));eventArgument+="&RowDropOnDepth="+dropOnDepth;}if(serverSideConfirmed!=null){eventArgument+="&ServerSideConfirmed=true";}if(tableDroppedOn!=null){var nonUniqueId=UITools.GetPIAttr(tableDroppedOn,"non-unique-id");eventArgument+="&MetafuseTableIdDroppedOn="+nonUniqueId;}if(otherElementDroppedOn!=null){eventArgument+="&OtherElementDroppedOnId="+otherElementDroppedOn.id;if(showProcessingMessageId==""){otherElementDroppedOn.id;}}UITools.SetPIAttr(table,"busy","1");Ajax.DoAjaxPostBack(MetafuseTable_GetTableUniqueID(table),eventArgument,false,showProcessingMessageId,"",false,true,serverResponse);}else{MetafuseTable_RowMoveDropPerformMove(row.id,rowDropOn.id,rows,rowAfter.id,isChild);}};function MetafuseTable_IsBusy(table){table=GetElementById(table);var busy=UITools.GetPIAttr(table,"busy")
if(busy=="1"||busy=="true"){MetafuseTable_AlertBusyMessage(table);return true;}return false;};MetafuseTable.prototype.GetBusyMessage=MetafuseTable_GetBusyMessage;function MetafuseTable_GetBusyMessage(){return"Another action is still pending, and must complete before proceeding.<p>Please try again after the previous action is complete.</p>";};MetafuseTable.prototype.AlertBusyMessage=MetafuseTable_AlertBusyMessage;function MetafuseTable_AlertBusyMessage(table){table=GetElementById(table);var busyMessage=UITools.GetPIAttr(table,"busy-message");if(busyMessage==""){busyMessage=MetafuseTable_GetBusyMessage();}UITools.ShowAlertBox(busyMessage,"",false,null,"fade");};MetafuseTable.prototype.GetRowName=MetafuseTable_GetRowName;function MetafuseTable_GetRowName(row){var name="";var row=MetafuseTable_GetRowMainFromElement(row);if(row){var table=MetafuseTable_GetTableMain(row);var nameCellAttr=UITools.GetPIAttr(table,"row-name-cell-index");if(nameCellAttr!=""){var indexToLookup=MathTools.ParseFloat(nameCellAttr);var cells=$(row).children("TD");var cellsSS=null;var cell=null;var rowSS=MetafuseTable_GetRowSplitScreenFromElement(row);if(rowSS){cellsSS=$(rowSS).children("TD");if(indexToLookup<cellsSS.length){cell=cellsSS[indexToLookup];}else{indexToLookup=indexToLookup-cellsSS.length;}}if(cell==null){cell=cells[indexToLookup];}if(cell!=null){if(BrowserTools.IsInternetExplorer()){name=$(cell).text();}else{name=cell.textContent;}if(name==null||name==""){var inputs=$(cell).find("input");if(inputs.length>0){var input=inputs[0];name=FormTools.Get(input);}}}}else{name=UITools.GetPIAttr(row,"row-name");}var onAfterGetRowName=UITools.GetPIAttr(table,"javascript-after-get-row-name");if(onAfterGetRowName!=""){name=Utils.ExecuteFunctionByName(onAfterGetRowName,window,name);}}return name;};function MetafuseTable_GetDragObject(element){var tableMain=MetafuseTable_GetTableMain(element);if(tableMain){var dragObj=window[tableMain.id+"-row-drag-obj"];if(dragObj==null){dragObj=new MetafuseGenericDragObject();window[tableMain.id+"-row-drag-obj"]=dragObj;}return dragObj;}return null;};function MetafuseTable_RowMoveSelectOnMouseDown(row,localEvent){row=MetafuseTable_GetRowMainFromElement(row);if(row){var dragObj=MetafuseTable_GetDragObject(row);if(dragObj){dragObj.StopDrag();dragObj.StartDragWatch(localEvent);dragObj.OnDragging=function(){if(dragObj.HasMouseMoved(5)){dragObj.StopDrag();MetafuseTable_RowMoveSelect(row.id,localEvent);UITools.CancelBubble(localEvent);return false;}};}else{return;}}return false;};function MetafuseTable_RowMoveSelect(element,localEvent){element=GetElementById(element);var row;if(element.tagName=="TR"){row=element;}else{row=this.GetRowContainingElement(element,true);}document.body.style.cursor='move';if(row){var tableMain=MetafuseTable_GetTableMain(row);var	dragObj=window[tableMain.id+"-row-drag-obj"];if(dragObj==null){dragObj=new MetafuseGenericDragObject();window[tableMain.id+"-row-drag-obj"]=dragObj;}var moveCell=UITools.GetParentNodeByTagName(element,"TD");var nameCellClone=null;var nameCellAttr=UITools.GetPIAttr(tableMain,"row-name-cell-index");if(nameCellAttr!=null){var indexToUse=MathTools.ParseFloat(nameCellAttr);var rowName=row;var rowSS=GetElementById(row.id+"_ss");if(rowSS){if(indexToUse<rowSS.cells.length){rowName=rowSS;}else{indexToUse=indexToUse-rowSS.cells.length;}}var rowCells=$(rowName).children("TD");var nameCell=rowCells[indexToUse];nameCellClone=nameCell.cloneNode(true);nameCellClone.className="OF NW";nameCellClone.style.height=UITools.GetElementHeight(nameCell)+'px';}else{nameCellClone=moveCell.cloneNode(true);}UITools.DisableElement(nameCellClone);for(var ii=0;ii<nameCellClone.childNodes.length;ii++){var childNode=nameCellClone.childNodes[ii];UITools.DisableElement(childNode);if(childNode.tagName=="A"){if(childNode.childNodes&&childNode.childNodes.length>0&&childNode.childNodes[0].tagName=="IMG"){var img=childNode.childNodes[0];var onmouseover=img.getAttribute("onmouseover");if(onmouseover&&onmouseover!=null&&onmouseover!=""){img.setAttribute("onmouseover","return false;");}}}}var dragTable=dragObj.GetGenericDragDiv(nameCellClone.innerHTML);var x=UITools.GetEventPageXCoordinate(localEvent)+10;var y=UITools.GetEventPageYCoordinate(localEvent)-12;dragObj.OnAfterStopDrag=function(metafuseDragObject){UITools.HideDivAndIFrame(dragTable);document.body.style.cursor='default';var tablesToMonitor=new Array();tablesToMonitor[0]=tableMain;if(UITools.GetPIAttr(tableMain,"row-drop-pi-tables-monitor")!=""){var a=UITools.GetPIAttr(tableMain,"row-drop-pi-tables-monitor").split(',');for(var i=0;i<a.length;i++){var tmid=a[i];var tm=GetElementById(tmid);if(tm!=null){tablesToMonitor[tablesToMonitor.length]=tm;}}}var tableOver=null;for(var i=0;i<tablesToMonitor.length;i++){var tableToTest=tablesToMonitor[i];var rowIdOver=UITools.GetPIAttr(tableToTest,"row-over-id");var relatedIdSuffixes=null;var relatedIdSuffixes=MetafuseTable_GetRelatedSuffixesArray(tableToTest);if(relatedIdSuffixes==null){relatedIdSuffixes=MetafuseTable_GetRelatedSuffixesHighlightArray(tableToTest);}if(rowIdOver!=""){var isOverElement=false;if(dragObj.IsMouseOverElement(rowIdOver)||dragObj.IsMouseOverElement(rowIdOver+"_ss")){isOverElement=true;}else if(relatedIdSuffixes){for(var ii=0;ii<relatedIdSuffixes.length;ii++){var suffix=relatedIdSuffixes[ii];var idToTest=rowIdOver+suffix;if(dragObj.IsMouseOverElement(idToTest)||dragObj.IsMouseOverElement(idToTest+"_ss")){isOverElement=true;}}}if(isOverElement){var idToTest=rowIdOver;var rowOver=GetElementById(rowIdOver);if(rowOver==null||UITools.GetPIAttr(rowOver,"id")==""){if(relatedIdSuffixes){for(var ii=0;ii<relatedIdSuffixes.length;ii++){var suffixIdToTest=null;var suffix=relatedIdSuffixes[ii];var suffixSS=suffix+"_ss";if(idToTest.indexOf(suffix)==idToTest.length-suffix.length){suffixIdToTest=idToTest.substr(0,idToTest.length-suffix.length);}else if(idToTest.indexOf(suffixSS)==idToTest.length-suffixSS.length){suffixIdToTest=idToTest.substr(0,idToTest.length-suffixSS.length);}if(suffixIdToTest){rowOver=GetElementById(suffixIdToTest);if(rowOver&&UITools.GetPIAttr(rowOver,"id")!=""){idToTest=suffixIdToTest;break;}}}}}if(idToTest!=""){var overTable=MetafuseTable_GetTableMain(rowOver);var rowOverTableId=null;if(overTable&&overTable.id!=tableMain.id){rowOverTableId=overTable.id;}MetafuseTable_RowMoveDrop(row.id,rowOver.id,rowOverTableId);}break;}}}UITools.SetPIAttr(tableMain,"row-dragging-id","");};UITools.ShowDivAndIFrameAtXY(x,y,dragTable,null,0,0,false,true);UITools.SetPIAttr(tableMain,"row-dragging-id",row.id);dragObj.StartDrag(localEvent,dragTable,null);UITools.CancelBubble(localEvent);}return false;};function MetafuseTable_SaveTable(elementId,causesValidation){var table=MetafuseTable_GetTableMain(elementId);if(MetafuseTable_IsBusy(table)){return false;}UITools.SetPIAttr(table,"busy","1");if(this.SerializeUpdateXml()!=""){var eventArgument="SAVELIST";var elementToProcess=null;if(elementId){elementToProcess=GetElementById(elementId);}if(!elementToProcess){elementToProcess=this.ElementId;}if(causesValidation){causesValidation=true;}else{causesValidation=false;}UITools.ShowAlertBox('TODO: add method to have event after save list so we can set the busy message properly');Ajax.DoAjaxPostBack(this.UniqueId,eventArgument,causesValidation,elementToProcess,"",false,true);UITools.SetPIAttr(table,"busy","");}else{UITools.ShowAlertBox("There aren't any items changed on the form, your command was cancelled");UITools.SetPIAttr(table,"busy","");}};MetafuseTable.prototype.SerializeUpdateXml=MetafuseTable_SerializeUpdateXml;function MetafuseTable_SerializeUpdateXml(isChildList){var hasDeleted=false;var hasCreated=false;var hasUpdated=false;var deletedList="";var createdList="";var updatedList="";var list="";if(this.ObjectsDeleted!=null){for(var key in this.ObjectsDeleted){var metafuseTableRowObject=this.ObjectsDeleted[key];if(metafuseTableRowObject.IsObjectDeleted&&!metafuseTableRowObject.IsObjectCreated){deletedList+="<o id=\""+metafuseTableRowObject.Id+"\" d=\"1\"/>";hasDeleted=true;}}if(hasDeleted){deletedList="<dl>"+deletedList+"</dl>";}}if(this.ObjectsCreated!=null){for(var key in this.ObjectsCreated){var metafuseTableRowObject=this.ObjectsCreated[key];var xml=metafuseTableRowObject.UpdatedValuesXml;if(xml!=null&&xml!=""){createdList+=xml;hasCreated=true;}}}if(hasCreated){createdList="<cl>"+createdList+"</cl>";}if(this.ObjectsUpdated!=null){for(var key in this.ObjectsUpdated){var metafuseTableRowObject=this.ObjectsUpdated[key];var xml=metafuseTableRowObject.UpdatedValuesXml;if(xml!=null&&xml!=""){updatedList+=xml;hasUpdated=true;}}if(hasUpdated){updatedList="<ul>"+updatedList+"</ul>";}}if(hasDeleted||hasCreated||hasUpdated){if(!isChildList){list="<xml>";list+="<fd>";list+=this.SerializeFormDefinitionFields();list+="</fd>";}if(hasDeleted){list+=deletedList;}if(hasCreated){list+=createdList;}if(hasUpdated){list+=updatedList;}if(!isChildList){list+="</xml>";}}if(!isChildList){if(list!=null&&list!=""){var changeHiddenElement=GetElementById(this.ElementId+"_Changes");if(changeHiddenElement==null){$(document.forms[0]).prepend("<input type=\"hidden\" id=\""+this.ElementId+"_Changes\" name=\""+this.ElementId+"_Changes\" value=\"\" />");}FormTools.Set(this.ElementId+"_Changes",list);}}return list;};MetafuseTable.prototype.SetSort=MetafuseTable_SetSort;function MetafuseTable_SetSort(sortString){var sortHiddenElement=GetElementById(this.UniqueId+"_Sort");if(sortHiddenElement==null&&sortString!=null&&sortString!=""){$(document.forms[0]).prepend("<input type=\"hidden\" id=\""+this.UniqueId+"_Sort\" name=\""+this.UniqueId+"_Sort\" value=\"\" />");}FormTools.Set(this.UniqueId+"_Sort",sortString);};MetafuseTable.prototype.SerializeFormDefinitionFields=MetafuseTable_SerializeFormDefinitionFields;function MetafuseTable_SerializeFormDefinitionFields(){var fds="";for(var i=0;i<this.FormDefinition.Fields.length;i++){var field=this.FormDefinition.Fields[i];fds+="<ff i=\""+i.toString()+"\" n=\""+field.Name+"\"";if(field.ChildMetafuseTableVar!=null){fds+=">";var cmt=field.GetChildMetafuseTable();if(cmt!=null){fds+=cmt.SerializeFormDefinitionFields();}fds+="</ff>";}else{fds+="/>";}}return fds;};function MetafuseTable_OnUnload(){var hasDeleted=false;var hasCreated=false;var hasUpdated=false;if(this.ObjectsDeleted){for(var key in this.ObjectsDeleted){hasDeleted=true;break;}}if(this.ObjectsCreated){for(var key in this.ObjectsCreated){hasCreated=true;break;}}if(this.ObjectsUpdated){for(var key in this.ObjectsUpdated){hasUpdated=true;break;}}if(hasDeleted||hasCreated||hasUpdated){if(confirm(this.OnUnloadMessage)){this.SaveTable();}}};MetafuseTable.prototype.ReplaceMetafuseTableRowObjectId=MetafuseTable_ReplaceMetafuseTableRowObjectId;function MetafuseTable_ReplaceMetafuseTableRowObjectId(previousId,newId){var ro=this.ObjectsById[previousId];if(!ro){alert("Unable to update the table row object with id '"+previousId+"' with the new id '"+newId+"' because the existing row could not be located in the list.  The problem could have occured because the list was modified by another user, please reload the page.  Contact your system administrator if the problem persists.");}else{var row=GetElementById(ro.Id);var table=MetafuseTable_GetTableMain(row);if(!row){alert("Able to locate the id '"+previousId+"' in the metafuse table row object list, but unable to find the row that corresponds with the id.  Changing the row id to '"+newId+"'");}else{var rowSS=GetElementById(row.id+"_ss");ro.Id=newId;row.id=newId;if(rowSS){rowSS.id=newId+"_ss";}delete this.ObjectsById[previousId];this.ObjectsById[ro.Id]=ro;var rows=$(table).children("tbody").children("[id-parent='"+previousId+"']").attr("data-pi-id-parent",newId);var suffixes=MetafuseTable_GetRelatedSuffixesArray(table);if(suffixes!=null){for(var i=0;i<suffixes.length;i++){var suffix=suffixes[i];var relatedRow=GetElementById(previousId+suffix);if(relatedRow){relatedRow.id=newId+suffix;}}}}}};MetafuseTable.prototype.ClearCreatedUpdatedDeletedList=MetafuseTable_ClearCreatedUpdatedDeletedList;function MetafuseTable_ClearCreatedUpdatedDeletedList(){if(this.ObjectsDeleted!=null){for(var key in this.ObjectsDeleted){var metafuseTableRowObject=this.ObjectsDeleted[key];this.ParentIdOriginal=this.ParentId;metafuseTableRowObject.IsObjectDeleted=false;metafuseTableRowObject.IsObjectDirty=false;metafuseTableRowObject.IsObjectCreated=false;}}if(this.ObjectsUpdated!=null){for(var key in this.ObjectsUpdated){var metafuseTableRowObject=this.ObjectsUpdated[key];this.ParentIdOriginal=this.ParentId;metafuseTableRowObject.IsObjectDeleted=false;metafuseTableRowObject.IsObjectDirty=false;metafuseTableRowObject.IsObjectCreated=false;}}if(this.ObjectsCreated!=null){for(var key in this.ObjectsCreated){var metafuseTableRowObject=this.ObjectsCreated[key];this.ParentIdOriginal=this.ParentId;metafuseTableRowObject.IsObjectDeleted=false;metafuseTableRowObject.IsObjectDirty=false;metafuseTableRowObject.IsObjectCreated=false;}}this.ObjectsDeleted=new Object();this.ObjectsUpdated=new Object();this.ObjectsCreated=new Object();};MetafuseTable.prototype.UpdateAjaxAddEditRemoveSettings=MetafuseTable_UpdateAjaxAddEditRemoveSettings;function MetafuseTable_UpdateAjaxAddEditRemoveSettings(enableOnAddRowObject,enableOnUpdateRowObject,enableOnRemoveRowObject,enableRowMoveDrop,enableOnRowMoveDrop,enableAfterSetFormDataAjax,enableOnAddRowObjectCausesValidation,enableOnUpdateRowObjectCausesValidation,enableOnRemoveRowObjectCausesValidation,enableSerializeXmlListOnAddRowObject,enableSerializeXmlListOnUpdateRowObject,enableSerializeXmlListOnRemoveRowObject){this.EnableOnAddRowObject=enableOnAddRowObject;this.EnableOnUpdateRowObject=enableOnUpdateRowObject;this.EnableOnRemoveRowObject=enableOnRemoveRowObject;this.EnableRowMoveDrop=enableRowMoveDrop;this.EnableOnRowMoveDrop=enableOnRowMoveDrop;this.EnableOnAfterSetFormDataAjax=enableAfterSetFormDataAjax;this.EnableOnAddRowObjectCausesValidation=enableOnAddRowObjectCausesValidation;this.EnableOnUpdateRowObjectCausesValidation=enableOnUpdateRowObjectCausesValidation;this.EnableOnRemoveRowObjectCausesValidation=enableOnRemoveRowObjectCausesValidation;this.EnableSerializeXmlListOnAddRowObject=enableSerializeXmlListOnAddRowObject;this.EnableSerializeXmlListOnUpdateRowObject=enableSerializeXmlListOnUpdateRowObject;this.EnableSerializeXmlListOnRemoveRowObject=enableSerializeXmlListOnRemoveRowObject;};MetafuseTable.prototype.CreateMetafuseTableRowObjectValue=MetafuseTable_CreateMetafuseTableRowObjectValue;MetafuseTable.prototype.V=MetafuseTable_CreateMetafuseTableRowObjectValue;function MetafuseTable_CreateMetafuseTableRowObjectValue(value,text){return new MetafuseTableRowObjectValue(value,text);};MetafuseTable.prototype.GetRowKey=MetafuseTable_GetRowKey;function MetafuseTable_GetRowKey(row){row=GetElementById(row);if(row.id.indexOf("_ss")==row.id.length-3){return row.id.substr(0,row.id.length-3);}else{return row.id;}};MetafuseTable.prototype.GetRowContainingElement=MetafuseTable_GetRowContainingElement;function MetafuseTable_GetRowContainingElement(element,dontAlertWhenCannotFindElementOrParent){element=GetElementById(element);if(element){var parentNode=element;while(parentNode!=null){if(parentNode.nodeName=="TR"){if(parentNode.parentNode.parentNode.id==this.ElementId||parentNode.parentNode.parentNode.id==this.ElementIdLeftPaneTable){return parentNode;}}parentNode=parentNode.parentNode;}if(!dontAlertWhenCannotFindElementOrParent){alert("Unable to find the row the supplied element "+element.toString()+" is located in.");}}else{if(!dontAlertWhenCannotFindElementOrParent){alert("Unable to find the row the supplied element, because the supplied element is null is located in.");}}};MetafuseTable.prototype.ReplaceRows=MetafuseTable_ReplaceRows;function MetafuseTable_ReplaceRows(metafuseTableUpdate,updateValues){var ts=new Date();ts=ts.valueOf();UITools.InsertHTML(metafuseTableUpdate.ReceivedTableHtml);var receivedTable=GetElementById(metafuseTableUpdate.ReceivedTableId);var rows=$(receivedTable).children('tbody').children('tr');receivedTable.parentNode.removeChild(receivedTable);var hasSplitScreen=false;while(rows.length>0){row=rows[0];rows.splice(0,1);if(row.id!=null&&row.id!=""){var id=row.id;if(id.endsWith("_ss")){hasSplitScreen=true;}var replaceRow=GetElementById(id);if(replaceRow!=null){var depth=UITools.GetPIAttr(replaceRow,"depth");if(depth==""&&UITools.GetPIAttr(replaceRow,"expand-collapse")=="1"){depth="0";}row.id=id;$(replaceRow).replaceWith(row);var replacedRow=GetElementById(id);if(depth!=""){UITools.SetPIAttr(replacedRow,"depth-before-last-replace-row",depth);}}if(updateValues){var metafuseTableRowObject=metafuseTableUpdate.ObjectsById[id];if(metafuseTableRowObject!=null){var metafuseTableRowObjectToUpdate=this.ObjectsById[id];if(metafuseTableRowObjectToUpdate){metafuseTableRowObjectToUpdate.Values=metafuseTableRowObject.Values;}}}}}if(hasSplitScreen){this.SyncRowHeights();}this.OnAfterReplaceRows(metafuseTableUpdate);};MetafuseTable.prototype.InsertRows=MetafuseTable_InsertRows;function MetafuseTable_InsertRows(metafuseTableInsert){this.InsertMetafuseTableRowObjectsFromMetafuseTable(metafuseTableInsert);};MetafuseTable.prototype.GetNextTableRow=MetafuseTable_GetNextTableRow;function MetafuseTable_GetNextTableRow(row){return Utils.GetNextTableRow(row);};MetafuseTable.prototype.GetNextTableRowObject=MetafuseTable_GetNextTableRowObject;function MetafuseTable_GetNextTableRowObject(row,includeOnlyVisible){row=GetElementById(row);if(row!=null){var nextObjectRow=row.nextSibling;while(nextObjectRow!=null){if(nextObjectRow.id!=null&nextObjectRow.id!=""&&(includeOnlyVisible==false||nextObjectRow.style.display!="none")){var objectToTest=this.ObjectsById[nextObjectRow.id];if(objectToTest!=null){return objectToTest;}}nextObjectRow=nextObjectRow.nextSibling;}}return null;};function MetafuseTable_ClearCollapsedNodeWithChildrenLoaded(id){var row=MetafuseTable_GetRowMainFromElement(id);if(UITools.GetPIAttr(row,"c")=="1"){var jsObj=MetafuseTable_GetJSObject(row);var rows=MetafuseTable_GetRowChildrenAndRelated(row);for(var i=0;i<rows.length;i++){var r=rows[i];var rSS=MetafuseTable_GetRowSplitScreenFromElement(r);if(jsObj&&r.id){delete jsObj.ObjectsById[r.id];}$(r).remove();if(rSS){$(rSS).remove();}}UITools.SetPIAttr(row,"cl","0");}};MetafuseTable.prototype.SetSort=MetafuseTable_SetSort;function MetafuseTable_SetSort(sortString){var sortHiddenElement=GetElementById(this.UniqueId+"_Sort");if(sortHiddenElement==null&&sortString!=null&&sortString!=""){$(document.forms[0]).prepend("<input type=\"hidden\" id=\""+this.UniqueId+"_Sort\" name=\""+this.UniqueId+"_Sort\" value=\"\" />");}FormTools.Set(this.UniqueId+"_Sort",sortString);};MetafuseTable.prototype.Sort=MetafuseTable_Sort;function MetafuseTable_Sort(element,sortColumn){var sorts=FormTools.Get(this.UniqueId+"_Sort");var sortDirection="0";if(sorts!=""){var sortProperties=sorts.split(",");sorts="";var count=0;for(var i=0;i<sortProperties.length;i++){var sortProperty=sortProperties[i];var sortPropertyArray=sortProperty.split("|");if(sortPropertyArray[0]==sortColumn){if(sortPropertyArray[1]=="0"&&i==0){sortDirection="1";}}else{if(sorts!=""){sorts+=",";}sorts+=sortProperty;count++;}if(count==3){break;}}}var comma="";if(sorts!=""){comma=","}sorts=sortColumn+"|"+sortDirection+comma+sorts;this.SetSort(sorts);Ajax.DoAjaxPostBack(this.UniqueId,"SORT",false,element,"",false,false,null);return false;};MetafuseTable.prototype.RemoveNamingContainerIdFromRowId=MetafuseTable_RemoveNamingContainerIdFromRowId;function MetafuseTable_RemoveNamingContainerIdFromRowId(id){if(id!=null&&id!=""){id=id.substring(id.lastIndexOf("_")+1,id.length);}return id;};MetafuseTable.prototype.EKH=MetafuseTable_EKH;function MetafuseTable_EKH(element,localEvent){if(IsEnterKey(localEvent)){element=GetElementById(element);if(element!=null&&element.onchange&&typeof(element.onchange)=='function'){try{element.onchange();}catch(e){}}var getFormDataFunction=this.ObjectId+".FormDefinition.GetFormData();";setTimeout(getFormDataFunction,300);if(element&&(typeof element.blur==='function')){element.blur();}return false;}return true;};MetafuseTable.prototype.SyncRowHeights=MetafuseTable_SyncRowHeights;function MetafuseTable_SyncRowHeights(table){if(table==null){table=GetElementById(this.ElementId);}if(table){var $table=$(table);var $tbody=$table.children("TBODY");var $rows=$tbody.children("TR");for(var i=0;i<$rows.length;i++){var row=$rows[i];var ssRow=GetElementById(row.id+"_ss");if(ssRow){MetafuseTable_SyncRowHeight(row,ssRow);}}}};MetafuseTable.prototype.SyncRowHeight=MetafuseTable_SyncRowHeight;function MetafuseTable_SyncRowHeight(row1,row2){var $row1=$(row1);var $row2=$(row2);var h=$row1.height();var sh=$row2.height();if(h!=sh){if(h>sh){$row2.height(h);}else if(h<sh){$row1.height(sh);}}};function MetafuseTableFormDefinition(metafuseTable,formRowId,addRowLocationType,addRowLocationRowId,isFormInlineOnEdit,elementIdToFocusOn,blankRowId,editCellIndex,editCellAnchorHtml,deleteCellIndex,deleteCellAnchorHtml,addCommandElementId,updateCommandElementId,hideFormRowOnClearFormData,onValidateForm,onBeforeGetFormData,onAfterGetFormData,onBeforeSetFormData,onAfterSetFormData,onBeforeClearFormData,onAfterClearFormData,onBeforeDeleteFormData,onAfterDeleteFormData,fields){this.MetafuseTable=metafuseTable;this.BlankRowId=blankRowId;this.FormRowId=formRowId;this.AddRowLocationType=addRowLocationType;this.AddRowLocationRowId=addRowLocationRowId;this.IsFormInlineOnEdit=isFormInlineOnEdit;this.ElementIdToFocusOn=elementIdToFocusOn;this.Fields=fields;this.EditCellIndex=editCellIndex;this.EditCellAnchorHtml=editCellAnchorHtml;this.DeleteCellIndex=deleteCellIndex;this.DeleteCellAnchorHtml=deleteCellAnchorHtml;this.AddCommandElementId=addCommandElementId;this.UpdateCommandElementId=updateCommandElementId;this.HideFormRowAfterClearFormData=false;this.EditingRowId=null;this.EditingObject=null;this.AddNewRowsToParentId=null;this.HasAttemptedToEditOneObject=false;this.RowIdToInsertFormBeforeForAdd=null;this.RowToInsertFormBeforeForAdd=null;this.FieldsWithMissingOptionsInserted=null;if(hideFormRowOnClearFormData){this.HideFormRowAfterClearFormData=hideFormRowOnClearFormData;}if(onValidateForm!=null){this.OnValidateForm=onValidateForm;}else{this.OnValidateForm=function(formDefinition){return true;};}if(onBeforeGetFormData!=null){this.OnBeforeGetFormData=onBeforeGetFormData;}if(onAfterGetFormData!=null){this.OnAfterGetFormData=onAfterGetFormData;}else{this.OnAfterGetFormData=function(){};}if(onBeforeSetFormData!=null){this.OnBeforeSetFormData=onBeforeSetFormData;}else{this.OnBeforeSetFormData=function(){};}if(onAfterSetFormData!=null){this.OnAfterSetFormData=onAfterSetFormData;}else{this.OnAfterSetFormData=function(){};}if(onBeforeClearFormData!=null){this.OnBeforeClearFormData=onBeforeClearFormData;}else{this.OnBeforeClearFormData=function(){};}if(onAfterClearFormData!=null){this.OnAfterClearFormData=onAfterClearFormData;}else{this.OnAfterClearFormData=function(){};}if(onBeforeDeleteFormData!=null){this.OnBeforeDeleteFormData=onBeforeDeleteFormData;}else{this.OnBeforeDeleteFormData=function(){};}if(onAfterDeleteFormData!=null){this.OnAfterDeleteFormData=onAfterDeleteFormData;}else{this.OnAfterDeleteFormData=function(){};}this.JavaScriptOnAfterSetFormDataCreateRowAsChild=function(){};};MetafuseTableFormDefinition.prototype.BeforeGetFormData=MetafuseTableFormDefinition_BeforeGetFormData;function MetafuseTableFormDefinition_BeforeGetFormData(element){if(this.OnBeforeGetFormData!==undefined||this.OnBeforeGetFormData!=null){this.OnBeforeGetFormData(element);}};MetafuseTableFormDefinition.prototype.GetFormDataServerConfirmed=MetafuseTableFormDefinition_GetFormDataServerConfirmed;function MetafuseTableFormDefinition_GetFormDataServerConfirmed(confirmMessage){if(confirm(confirmMessage)){var saveRowCommand=this.MetafuseTable.ObjectId+".FormDefinition.GetFormData(null, null, true)";setTimeout(saveRowCommand,100);};};MetafuseTableFormDefinition.prototype.GetFormData=MetafuseTableFormDefinition_GetFormData;function MetafuseTableFormDefinition_GetFormData(addUpdateButton,functionToExecuteAfterClear,serverSideValidated){if(addUpdateButton==null){addUpdateButton=this.GetSaveButtonTableCell();}var table=MetafuseTable_GetTableMain(addUpdateButton);if(table==null&&this.MetafuseTable.ElementId){table=GetElementById(this.MetafuseTable.ElementId);}UITools.ToggleElementDisable(addUpdateButton,false);if(MetafuseTable_IsBusy(table)){UITools.ToggleElementDisable(addUpdateButton,true);return false;}UITools.SetPIAttr(table,"busy","1");var valid=this.OnValidateForm(this);if(!valid){UITools.SetPIAttr(table,"busy","");UITools.ToggleElementDisable(addUpdateButton,true);return false;}var serverSideValidatedString="";if(serverSideValidated){serverSideValidatedString="SERVERVALIDATED:true";}this.BeforeGetFormData(this);var rowEditing=null;var rowEditingSS=null;var objectEditing=null;var rowEditingBefore=null;var rowEditingBeforeSS=null;var objectEditingValuesBefore=null;var objectEditingWasUpdatedBefore=false;var objectEditingXmlBefore=null;var rowObjectBeforeCreatedRow=null;var parentIdCreatedRow=null;var rowBeforeCreatedRow=null;if(this.EditingRowId==null||this.EditingRowId==""){rowEditing=this.GetNewBlankRow();var guid=rowEditing.id;$(rowEditing).attr("data-pi-id",rowEditing.id);var appendToTable=GetElementById(this.MetafuseTable.ElementId);var appendToTableTBody=appendToTable.tBodies[0];var insertBeforeRow=this.GetRowToInsertNewRowBefore();if(insertBeforeRow){appendToTableTBody.insertBefore(rowEditing,insertBeforeRow);}else{appendToTableTBody.appendChild(rowEditing);}var appendToTableSS=GetElementById(this.MetafuseTable.ElementIdLeftPaneTable);if(appendToTableSS){var blankRowSS=GetElementById(this.BlankRowId+"_ss");if(blankRowSS==null){alert("ERROR: Invalid blank row id: "+this.BlankRowId+"_ss unable to locate the blank row in split screen, further processing will fail.");}rowEditingSS=blankRowSS.cloneNode(true);rowEditingSS.id=rowEditing.id+"_ss";var insertBeforeRowSS=null;if(insertBeforeRow){insertBeforeRowSS=GetElementById(insertBeforeRow.id+"_ss");}var appendToTableTBodySS=appendToTableSS.tBodies[0];if(insertBeforeRowSS){appendToTableTBodySS.insertBefore(rowEditingSS,insertBeforeRowSS);}else{appendToTableTBodySS.appendChild(rowEditingSS);}}var rows=$(appendToTableTBody).children("TR");for(var i=rowEditing.rowIndex-1;i>=0;i--){var r=rows[i];if(r.id!=null&&r.id!=""&&UITools.GetPIAttr(r,"id")!=""&&r.style.display!="none"){rowBeforeCreatedRow=r;break;}}if(rowBeforeCreatedRow){if(UITools.GetPIAttr(rowBeforeCreatedRow,"expand-collapse")=="1"&&UITools.GetPIAttr(rowBeforeCreatedRow,"c")!="1"){parentIdCreatedRow=rowBeforeCreatedRow.id;}else{var parentRow=MetafuseTable_GetParentRow(rowBeforeCreatedRow)
if(parentRow){parentIdCreatedRow=parentRow.id;}}}objectEditing=new MetafuseTableRowObject(guid,parentIdCreatedRow);objectEditing.IsObjectCreated=true;objectEditing.IsExpanded=true;objectEditing.IsChildrenLoaded=true;objectEditing.MetafuseTable=this.MetafuseTable;this.MetafuseTable.ObjectsById[objectEditing.Id]=objectEditing;this.MetafuseTable.ObjectsCreated[objectEditing.Id]=objectEditing;objectEditing.Values=new Array();for(var i=0;i<this.Fields.length;i++){var field=this.Fields[i];if(field.ValueIndex!=null&&field.ValueIndex>=0){objectEditing.Values[field.ValueIndex]=new MetafuseTableRowObjectValue(null,null);}}}else{rowEditing=GetElementById(this.EditingRowId);rowEditingSS=GetElementById(this.EditingRowId+"_ss");objectEditing=this.MetafuseTable.ObjectsById[this.EditingRowId];if(this.MetafuseTable.EnableOnUpdateRowObject){rowEditingBefore=rowEditing.cloneNode(true);rowEditingBefore.id=rowEditing.id+"_BEFORE";if(rowEditingSS){rowEditingBeforeSS=rowEditingSS.cloneNode(true);rowEditingBeforeSS.id=rowEditingSS.id+"_BEFORE";}objectEditingValuesBefore=objectEditing.Values;objectEditingXmlBefore=objectEditing.UpdatedValuesXml;if(this.MetafuseTable.ObjectsUpdated[objectEditing.Id]!=null){objectEditingWasUpdatedBefore=true;}}if(objectEditing.IsObjectCreated==false){this.MetafuseTable.ObjectsUpdated[objectEditing.Id]=objectEditing;}}var cells=null;if(rowEditingSS){cells=new Array();var cellsTemp=$(rowEditingSS).children("TD");if(cellsTemp){for(var i=0;i<cellsTemp.length;i++){cells[cells.length]=cellsTemp[i];}}var cellsTemp=$(rowEditing).children("TD");if(cellsTemp){for(var i=0;i<cellsTemp.length;i++){cells[cells.length]=cellsTemp[i];}}}else{cells=$(rowEditing).children("TD");}objectEditing.IsObjectDirty=true;var xml="<o id=\""+objectEditing.Id+"\"";if(objectEditing.IsObjectCreated==true&&objectEditing.ParentId!=null&&objectEditing.ParentId!=""){xml+=" p=\""+objectEditing.ParentId+"\"";}if(rowBeforeCreatedRow!=null){objectEditing.RowObjectBeforeCreatedRowId=rowBeforeCreatedRow.id;xml+=" a=\""+rowBeforeCreatedRow.id+"\"";}xml+=">";if(this.EditingRowId==null){this.InsertEditDeleteCellsIntoRow(cells);}if(this.Fields!=null){objectEditing.UpdatedValuesStringByFieldIndexForXml=new Array();for(var i=0;i<this.Fields.length;i++){var field=this.Fields[i];var childMetafuseTable=field.GetChildMetafuseTable();if(childMetafuseTable==null){if(field.FormElementId!=null&&field.FormElementId!=""){var value=field.GetFieldValue();var text=field.GetFieldText();if(text==null){text="";}xml+="<f i=\""+i+"\"><![CDATA["+value+"]]></f>";if(field.CellIndex!=null&&field.CellIndex>=0){var cell=cells[field.CellIndex];if(BrowserTools.IsInternetExplorer()){cell.innerText=text;}else{cell.innerHTML=text.replace(/\r\n/g,"<br/>").replace(/\n/g,"<br/>").replace(/\r/g,"");}}if(field.ValueIndex!=null&&field.ValueIndex>=0){var valueField=objectEditing.GetValueByIndex(field.ValueIndex);valueField.Value=value;valueField.Text=text;}objectEditing.UpdatedValuesStringByFieldIndexForXml[i]=value;}}else{var valueFieldArray=new Array();for(var key in childMetafuseTable.ObjectsById){var co=childMetafuseTable.ObjectsById[key];valueFieldArray[valueFieldArray.length]=co;}if(childMetafuseTable.ObjectsDeleted!=null){for(var key in childMetafuseTable.ObjectsDeleted){var co=childMetafuseTable.ObjectsDeleted[key];if(co!=null){valueFieldArray[valueFieldArray.length]=co;}}}objectEditing.Values[field.ValueIndex]=valueFieldArray;var value=childMetafuseTable.SerializeUpdateXml(true);xml+="<f i=\""+i+"\">"+value+"</f>";objectEditing.UpdatedValuesStringByFieldIndexForXml[i]=value;}}}xml+="</o>";objectEditing.UpdatedValuesXml=xml;this.OnAfterGetFormData(this,objectEditing);var metafuseAjaxPostBackObjectServerResponse=null;var self=this;if(objectEditing.IsObjectCreated){if(this.MetafuseTable.EnableSerializeXmlListOnAddRowObject){this.MetafuseTable.SerializeUpdateXml();}if(this.MetafuseTable.EnableOnAddRowObject){metafuseAjaxPostBackObjectServerResponse=new MetafuseAjaxPostBackObjectServerResponse();metafuseAjaxPostBackObjectServerResponse.OnAfterExecuteSuccessfulResponse=function(metafuseAjaxPostBackObjectServerResponse){if(metafuseAjaxPostBackObjectServerResponse.IsValid){rowEditing.style.display="";if(rowEditingSS){rowEditingSS.style.display="";}self.ClearFormData();UITools.SetPIAttr(table,"busy","");UITools.ToggleElementDisable(addUpdateButton,true);if(functionToExecuteAfterClear){functionToExecuteAfterClear();}}else{self.MetafuseTable.DeleteObjectRecursivelyPerformDelete(objectEditing.Id,true);UITools.SetPIAttr(table,"busy","");UITools.ToggleElementDisable(addUpdateButton,true);}};Ajax.DoAjaxPostBack(this.MetafuseTable.UniqueId,serverSideValidatedString+"ADDOBJECT:"+objectEditing.Id,this.MetafuseTable.EnableOnAddRowObjectCausesValidation,addUpdateButton,"Saving...",false,true,metafuseAjaxPostBackObjectServerResponse);}}else{if(this.MetafuseTable.EnableSerializeXmlListOnUpdateRowObject){this.MetafuseTable.SerializeUpdateXml();}if(this.MetafuseTable.EnableOnUpdateRowObject){metafuseAjaxPostBackObjectServerResponse=new MetafuseAjaxPostBackObjectServerResponse();metafuseAjaxPostBackObjectServerResponse.OnAfterExecuteSuccessfulResponse=function(metafuseAjaxPostBackObjectServerResponse){if(metafuseAjaxPostBackObjectServerResponse.IsValid){rowEditing.style.display="";if(rowEditingSS){rowEditingSS.style.display="";}self.ClearFormData();UITools.SetPIAttr(table,"busy","");UITools.ToggleElementDisable(addUpdateButton,true);if(functionToExecuteAfterClear){functionToExecuteAfterClear();}}else{var appendToTable=GetElementById(self.MetafuseTable.ElementId);var appendToTableTBody=appendToTable.getElementsByTagName("TBODY");appendToTableTBody=appendToTableTBody[0];var nextSibling=rowEditing.nextSibling;appendToTableTBody.removeChild(rowEditing);rowEditingBefore.id=objectEditing.Id;if(nextSibling!=null){appendToTableTBody.insertBefore(rowEditingBefore,nextSibling);}else{appendToTableTBody.appendChild(rowEditingBefore);}if(rowEditingSS){var appendToTableTBodySS=GetElementById(self.MetafuseTable.ElementIdLeftPaneTable).tBodies[0];var nextSiblingSS=rowEditingSS.nextSibling;appendToTableTBodySS.removeChild(rowEditingSS);rowEditingBeforeSS.id=objectEditing.Id+"_ss";if(nextSiblingSS!=null){appendToTableTBodySS.insertBefore(rowEditingBeforeSS,nextSiblingSS);}else{appendToTableTBodySS.appendChild(rowEditingBeforeSS);}}objectEditing.Values=objectEditingValuesBefore;objectEditing.UpdatedValuesXml=objectEditingXmlBefore;if(objectEditing.IsObjectCreated==false&&objectEditingWasUpdatedBefore==false){delete self.MetafuseTable.ObjectsUpdated[objectEditing.Id];}UITools.SetPIAttr(table,"busy","");UITools.ToggleElementDisable(addUpdateButton,true);}};Ajax.DoAjaxPostBack(this.MetafuseTable.UniqueId,serverSideValidatedString+"UPDATEOBJECT:"+objectEditing.Id,this.MetafuseTable.EnableOnUpdateRowObjectCausesValidation,addUpdateButton,"Saving...",false,true,metafuseAjaxPostBackObjectServerResponse);}}if(metafuseAjaxPostBackObjectServerResponse==null){UITools.ToggleDisplay(rowEditing,false);if(rowEditingSS){UITools.ToggleDisplay(rowEditingSS,false);}this.ClearFormData();UITools.SetPIAttr(table,"busy","");UITools.ToggleElementDisable(addUpdateButton,true);if(functionToExecuteAfterClear){functionToExecuteAfterClear();}}return false;};MetafuseTableFormDefinition.prototype.InsertEditDeleteCellsIntoRow=MetafuseTableFormDefinition_InsertEditDeleteCellsIntoRow;function MetafuseTableFormDefinition_InsertEditDeleteCellsIntoRow(cells){if(this.EditCellIndex>=0){var editCell=cells[this.EditCellIndex];if(editCell==null){alert("Unable to insert the edit cell at the index specified: "+this.EditCellIndex+" the cell does not exist in the blank row");}else{editCell.innerHTML+="<a href=\"javascript:;\" onclick=\"MetafuseTable_Edit(this);return false;\">"+this.EditCellAnchorHtml+"</a>&nbsp;";}}if(this.DeleteCellIndex>=0){var deleteCell=cells[this.DeleteCellIndex];if(deleteCell==null){alert("Unable to insert the delete cell at the index specified: "+this.DeleteCellIndex+" the cell does not exist in the blank row");}else{deleteCell.innerHTML+="<a href=\"javascript:;\" onclick=\""+this.MetafuseTable.ObjectId+".DO(this);return false;\">"+this.DeleteCellAnchorHtml+"</a>&nbsp;";}}};MetafuseTableFormDefinition.prototype.GetNewBlankRow=MetafuseTableFormDefinition_GetNewBlankRow;function MetafuseTableFormDefinition_GetNewBlankRow(){var guid=NewGuid();var blankRow=GetElementById(this.BlankRowId);if(blankRow==null){alert("ERROR: Invalid blank row id: "+this.BlankRowId+" unable to locate the blank row, further processing will fail.");}var newRow=rowEditing=blankRow.cloneNode(true);newRow.id=guid;return newRow;};MetafuseTableFormDefinition.prototype.GetRowToInsertNewRowBefore=MetafuseTableFormDefinition_GetRowToInsertNewRowBefore;function MetafuseTableFormDefinition_GetRowToInsertNewRowBefore(){var rowToInsertBefore=null;if(this.AddRowLocationType=='AddAfterSpecifiedRow'&&this.AddRowLocationRowId!=""){var afterRow=GetElementById(this.AddRowLocationRowId);if(afterRow==null){alert("Unable to add the record after the specified row since the element does not exist, row id: "+this.AddRowLocationRowId);}else{rowToInsertBefore=MetafuseTable_GetNextTableRow(this.AddRowLocationRowId);}}else if(this.AddRowLocationType=='AddBeforeSpecifiedRow'&&this.AddRowLocationRowId!=""){var rowToInsertBefore=GetElementById(this.AddRowLocationRowId);if(rowToInsertBefore==null){alert("Unable to insert the record before the specified row since the element does not exist, row id: "+this.AddRowLocationRowId);isSuccessful=false;}}return rowToInsertBefore;};MetafuseTableFormDefinition.prototype.SetFormData=MetafuseTableFormDefinition_SetFormData;function MetafuseTableFormDefinition_SetFormData(row){var objectEditing=row;if(isString(row)||row.tagName==="TR"){row=GetElementById(row);objectEditing=this.MetafuseTable.ObjectsById[row.id];}else{row=GetElementById(objectEditing.Id);}var self=this;var table=MetafuseTable_GetTableMain(this.MetafuseTable.ElementId);var editingRowId=UITools.GetPIAttr(table,"editing-row-id");if(editingRowId!=""){this.GetFormData(null,function(){var metafuseTable=window[self.MetafuseTable.ObjectId];metafuseTable.FormDefinition.SetFormData(row.id);});return false;}this.EditingRowId=row.id;UITools.SetPIAttr(table,"editing-row-id",row.id);this.EditingObject=objectEditing;var rowSS=GetElementById(row.id+"_ss");var formRow=GetElementById(this.FormRowId);var formRowSS=GetElementById(this.FormRowId+"_ss");var cells=null;var cellsForm=null;if(rowSS){cells=new Array();var cellsTemp=$(rowSS).children("TD");if(cellsTemp){for(var i=0;i<cellsTemp.length;i++){cells[cells.length]=cellsTemp[i];}}cellsTemp=$(row).children("TD");if(cellsTemp){for(var i=0;i<cellsTemp.length;i++){cells[cells.length]=cellsTemp[i];}}cellsForm=new Array();cellsTemp=$(formRowSS).children("TD");if(cellsTemp){for(var i=0;i<cellsTemp.length;i++){cellsForm[cellsForm.length]=cellsTemp[i];}}cellsTemp=$(formRow).children("TD");if(cellsTemp){for(var i=0;i<cellsTemp.length;i++){cellsForm[cellsForm.length]=cellsTemp[i];}}}else{cells=$(row).children("TD");cellsForm=$(formRow).children("TD");}if(this.IsFormInlineOnEdit){if(this.HasAttemptedToEditOneObject==false){var nextRow=Utils.GetNextTableRow(formRow);if(nextRow!=null){if(nextRow.id!=null&&nextRow.id!=""){this.RowIdToInsertFormBeforeForAdd=nextRow.id;}this.RowToInsertFormBeforeForAdd=nextRow;}this.HasAttemptedToEditOneObject=true;}var appendToTable=GetElementById(this.MetafuseTable.ElementId);var appendToTableTBody=appendToTable.getElementsByTagName("TBODY");appendToTableTBody=appendToTableTBody[0];appendToTableTBody.removeChild(formRow);row.style.display="none";appendToTableTBody.insertBefore(formRow,row);if(rowSS&&formRowSS){var appendToTableBodySS=GetElementById(this.MetafuseTable.ElementIdLeftPaneTable).tBodies[0];appendToTableBodySS.removeChild(formRowSS);rowSS.style.display="none";appendToTableBodySS.insertBefore(formRowSS,rowSS);}}this.OnBeforeSetFormData(this);for(var i=0;i<this.Fields.length;i++){var field=this.Fields[i];var childMetafuseTable=field.GetChildMetafuseTable();if(childMetafuseTable==null){var text="";var value="";var cell=null;if(field.CellIndex!=null&&field.CellIndex>=0){var text="";cell=cells[field.CellIndex];var input=GetElementById(field.FormElementId);var inputType=FormTools.GetFormElementType(input);var columnTypeFormat="";var rows=table.tBodies[0].rows;if(rows.length>0){columnTypeFormat=UITools.GetPIAttr(rows[0].cells[field.CellIndex],"column-type-format");}if(inputType=="MetafuseKendoEditor"||columnTypeFormat=='HTML'){text=cell.innerHTML;}else{text=cell.innerHTML;text=text.replace(/<BR>/gi,"\r\n");text=text.replace(/<[^<|>]+?>/gi,"");text=text.replace(/&lt;/g,"<");text=text.replace(/&gt;/g,">");text=text.replace(/&amp;/g,"&");text=text.replace(/&nbsp;/g," ");}if(field.ValueIndex==null||field.ValueIndex<0){value=text;}}if(field.ValueIndex!=null&&field.ValueIndex>=0){var metafuseTableRowObjectValue=objectEditing.GetValueByIndex(field.ValueIndex);if(metafuseTableRowObjectValue!=null){value=metafuseTableRowObjectValue.Value;if(value==null){value="";}if(field.CellIndex==null||field.CellIndex<0){text=metafuseTableRowObjectValue.Text;}}}if(field.DisableOnEdit){UITools.DisableElement(field.FormElementId);}else if(field.DisableOnAdd){UITools.EnableElement(field.FormElementId);}var success=field.SetFieldValue(value,text,cell);if(success==false&&field.MissingOptionsArray!=null&&field.MissingOptionsArray.length>0){if(this.FieldsWithMissingOptionsInserted==null){this.FieldsWithMissingOptionsInserted=new Array();}field.InsertMissingOptions();this.FieldsWithMissingOptionsInserted[this.FieldsWithMissingOptionsInserted.length]=field;}}else{var arrayObjects=objectEditing.Values[field.ValueIndex];childMetafuseTable.FormDefinition.SetFormDataChildRows(arrayObjects);}}for(var i=0;i<cellsForm.length;i++){var formcell=cellsForm[i];if($(formcell).children().length==0){var cell=cells[i];if(cell){formcell.className=cell.className;var text=cell.innerHTML;text=text.replace(/<BR>/gi,"\r\n");text=text.replace(/<[^<|>]+?>/gi,"");text=text.replace(/&lt;/g,"<");text=text.replace(/&gt;/g,">");text=text.replace(/&amp;/g,"&");text=text.replace(/&nbsp;/g," ");formcell.innerHTML='<span class="metafuse-table-no-input-cell">'+text+'<span>';}}}this.OnAfterSetFormData(this);UITools.Hide(UITools.GetPIAttr(table,"row-add-command-element-id"));UITools.Show(UITools.GetPIAttr(table,"row-update-command-element-id"));if(this.ElementIdToFocusOn!=null&&this.ElementIdToFocusOn!=""){setTimeout("UITools.FocusOnElement('"+this.ElementIdToFocusOn+"')",0);}if(this.MetafuseTable.EnableOnAfterSetFormDataAjax){var srvResp=new MetafuseAjaxPostBackObjectServerResponse();var self=this;srvResp.OnAfterExecuteSuccessfulResponse=function(srvResp){UITools.ToggleDisplay(self.FormRowId,false);};Ajax.DoAjaxPostBack(this.MetafuseTable.UniqueId,"SETFORMDATA:"+objectEditing.Id,false,null,"",false,true,srvResp);}else{UITools.ToggleDisplay(this.FormRowId,false);}return false;};MetafuseTableFormDefinition.prototype.SetFormDataChildRows=MetafuseTableFormDefinition_SetFormDataChildRows;function MetafuseTableFormDefinition_SetFormDataChildRows(childObjectArrayList){this.MetafuseTable.ClearMetafuseTable();if(childObjectArrayList==null||!isArray(childObjectArrayList)||childObjectArrayList.length==0){return;}var insertBeforeRow=null;var appendToTable=GetElementById(this.MetafuseTable.ElementId);var appendToTableTBody=appendToTable.getElementsByTagName("TBODY");appendToTableTBody=appendToTableTBody[0];var blankRow=GetElementById(this.BlankRowId);if(this.AddRowLocationType=='AddAfterSpecifiedRow'&&this.AddRowLocationRowId!=""){var afterRow=GetElementById(this.AddRowLocationRowId);if(afterRow==null){alert("Unable to add the record after the specified row since the element does not exist, row id: "+this.AddRowLocationRowId);}else{insertBeforeRow=afterRow.nextSibling;}}else if(this.AddRowLocationType=='AddBeforeSpecifiedRow'&&this.AddRowLocationRowId!=""){insertBeforeRow=GetElementById(this.AddRowLocationRowId);if(insertBeforeRow==null){alert("Unable to insert the record before the specified row since the element does not exist, row id: "+this.AddRowLocationRowId);}}for(var i=0;i<childObjectArrayList.length;i++){var mto=childObjectArrayList[i];if(mto.IsObjectDeleted){this.MetafuseTable.ObjectsDeleted[mto.Id]=mto;}else{mto.MetafuseTable=this.MetafuseTable;this.MetafuseTable.ObjectsById[mto.Id]=mto;if(mto.IsObjectCreated){this.MetafuseTable.ObjectsCreated[mto.Id]=mto;}if(mto.IsObjectUpdated){this.MetafuseTable.ObjectsCreated[mto.Id]=mto;}var newRow=blankRow.cloneNode(true);newRow.id=mto.Id;UITools.SetPIAttr(newRow,"id",mto.Id);var cells=$(newRow).children("TD");this.InsertEditDeleteCellsIntoRow(cells);for(var ii=0;ii<this.Fields.length;ii++){var field=this.Fields[ii];if(field.ValueIndex>=0){var childMetafuseTable=field.GetChildMetafuseTable();if(childMetafuseTable==null){if(field.ValueIndex!=null&&field.ValueIndex>=0){var metafuseTableRowObjectValue=mto.GetValueByIndex(field.ValueIndex);if(field.CellIndex!=null&&field.CellIndex>=0){var cell=cells[field.CellIndex]
var text=metafuseTableRowObjectValue.Text;text=field.OnAfterGetFieldText(text);if(text==null){text="";}var cell=cells[field.CellIndex];if(BrowserTools.IsInternetExplorer()){cell.innerText=text;}else{cell.innerHTML=text.replace(/\r\n/g,"<br/>").replace(/\n/g,"<br/>").replace(/\r/g,"");}}}}else{var childArrayObjects=mto.Values[field.ValueIndex];childMetafuseTable.FormDefinition.SetFormDataChildRows(childArrayObjects);}}}if(insertBeforeRow!=null){appendToTableTBody.insertBefore(newRow,insertBeforeRow);}else{appendToTableTBody.appendChild(newRow);}this.JavaScriptOnAfterSetFormDataCreateRowAsChild(this,mto);newRow.style.display="";}}this.OnAfterSetFormData(this);};MetafuseTableFormDefinition.prototype.ClearFormData=MetafuseTableFormDefinition_ClearFormData;function MetafuseTableFormDefinition_ClearFormData(){var table=MetafuseTable_GetTableMain(this.MetafuseTable.ElementId);var editingRowId=UITools.GetPIAttr(table,"editing-row-id");this.OnBeforeClearFormData(this);for(var i=0;i<this.Fields.length;i++){var field=this.Fields[i];var childMetafuseTable=field.GetChildMetafuseTable();if(field.DontClearValue==false){var childMetafuseTable=field.GetChildMetafuseTable();if(childMetafuseTable==null){field.SetFieldValue(field.DefaultValue,field.DefaultValue,null);}else{childMetafuseTable.ClearMetafuseTable();}}if(field.DisableOnEdit&&!field.DisableOnAdd){UITools.EnableElement(field.FormElementId);}else if(field.DisableOnAdd){UITools.DisableElement(field.FormElementId);}}if(this.FieldsWithMissingOptionsInserted!=null){for(var i=0;i<this.FieldsWithMissingOptionsInserted.length;i++){this.FieldsWithMissingOptionsInserted[i].RemoveMissingOptions();}this.FieldsWithMissingOptionsInserted=null;}if(editingRowId!=""&&this.IsFormInlineOnEdit){var formRow=GetElementById(this.FormRowId);var formRowSS=GetElementById(this.FormRowId+"_ss");$(formRow).find('.metafuse-table-no-input-cell').remove();var appendToTable=GetElementById(this.MetafuseTable.ElementId);var appendToTableTBody=appendToTable.getElementsByTagName("TBODY");appendToTableTBody=appendToTableTBody[0];appendToTableTBody.removeChild(formRow);var appendToTableTBodySS=null;if(formRowSS){appendToTableTBodySS=GetElementById(this.MetafuseTable.ElementIdLeftPaneTable).tBodies[0];appendToTableTBodySS.removeChild(formRowSS);$(formRowSS).find('.metafuse-table-no-input-cell').remove();}var formRowToInsertBefore=null;var formRowToInsertBeforeSS=null;if(this.RowIdToInsertFormBeforeForAdd!=null&&this.RowIdToInsertFormBeforeForAdd!=""){formRowToInsertBefore=GetElementById(this.RowIdToInsertFormBeforeForAdd);formRowToInsertBeforeSS=GetElementById(this.RowIdToInsertFormBeforeForAdd+"_ss");}if(formRowToInsertBefore==null&&this.RowToInsertFormBeforeForAdd!=null){if(this.RowToInsertFormBeforeForAdd.id!=null&&this.RowToInsertFormBeforeForAdd.id!=""){formRowToInsertBefore=GetElementById(this.RowToInsertFormBeforeForAdd.id);formRowToInsertBeforeSS=GetElementById(this.RowToInsertFormBeforeForAdd.id+"_ss");}if(formRowToInsertBefore==null){formRowToInsertBefore=this.RowToInsertFormBeforeForAdd;if(formRowToInsertBefore){formRowToInsertBeforeSS=GetElementById(formRowToInsertBefore.id+"_ss");}}}if(formRowToInsertBefore==null){appendToTableTBody.appendChild(formRow);if(formRowSS){formRowToInsertBeforeSS.appendChild(formRowSS);}}else{try{appendToTableTBody.insertBefore(formRow,formRowToInsertBefore);}catch(e){alert(e);appendToTableTBody.appendChild(formRow);}if(formRowSS){try{appendToTableTBodySS.insertBefore(formRowSS,formRowToInsertBeforeSS);}catch(e){alert(e);appendToTableTBodySS.appendChild(formRowSS);}}}UITools.ToggleDisplay(this.EditingRowId,false);if(formRowSS){UITools.ToggleDisplay(this.EditingRowId+"_ss",false);}}this.EditingRowId=null;UITools.SetPIAttr(table,"editing-row-id","");this.EditingObject=null;this.OnAfterClearFormData(this);UITools.Show(UITools.GetPIAttr(table,"row-add-command-element-id"));UITools.Hide(UITools.GetPIAttr(table,"row-update-command-element-id"));if(UITools.GetPIAttr("row-hide-clear-form")=="1"){UITools.Hide(this.FormRowId);UITools.Hide(this.FormRowId+"_ss");}};MetafuseTableFormDefinition.prototype.EditObject=MetafuseTableFormDefinition_EditObject;MetafuseTableFormDefinition.prototype.EO=MetafuseTableFormDefinition_EditObject;function MetafuseTableFormDefinition_EditObject(element){var row=MetafuseTable_GetRowMainFromElement(element);if(row==null){UITools.ShowAlertBox("Unable to locate the row "+element+" to edit.");return;}var table=MetafuseTable_GetTableMain(row);var dragObj=MetafuseTable_GetDragObject(row);if(dragObj!=null){dragObj.StopDrag();}var jsObj=MetafuseTable_GetJSObject(table);var objectEditing=jsObj.ObjectsById[row.id];if(objectEditing==null){return false;}else if(UITools.GetPIAttr("de")=="1"){var n=MetafuseTable_GetRowName(row);if(n==null||n==""){n="the item";}var msg=UITools.GetPIAttr(table,"permission-denied-edit-message");if(msg==""){msg="You do not have permission to edit <b>$RowName</b>";}msg=msg.replace(/\$RowName/g,n);UITools.ShowAlertBox(msg);return false;}jsObj.FormDefinition.SetFormData(objectEditing);};MetafuseTableFormDefinition.prototype.GetFieldByName=MetafuseTableFormDefinition_GetFieldByName;function MetafuseTableFormDefinition_GetFieldByName(fieldName){for(var i=0;i<this.Fields.length;i++){var field=this.Fields[i];if(field.Name==fieldName){return field;break;}}return null;};MetafuseTableFormDefinition.prototype.GetFieldValueIndex=MetafuseTableFormDefinition_GetFieldValueIndex;function MetafuseTableFormDefinition_GetFieldValueIndex(fieldName){var field=this.GetFieldByName(fieldName);if(field!=null){return field.ValueIndex;}return null;};MetafuseTableFormDefinition.prototype.GetFieldCellIndex=MetafuseTableFormDefinition_GetFieldCellIndex;function MetafuseTableFormDefinition_GetFieldCellIndex(fieldName){var field=this.GetFieldByName(fieldName);if(field!=null){return field.CellIndex;}return null;};MetafuseTableFormDefinition.prototype.GetSaveButtonTableCell=MetafuseTableFormDefinition_GetSaveButtonTableCell;function MetafuseTableFormDefinition_GetSaveButtonTableCell(){var saveButtonCell=null;if(this.EditCellIndex!=null&&this.EditCellIndex>=0){var indexToLookup=this.EditCellIndex;var editFormRow=GetElementById(this.FormRowId);var editFormRowSS=GetElementById(this.FormRowId+"_ss");var editFormRowCells=$(editFormRow).children("TD");var editFormRowCellsSS=null;if(editFormRowSS){editFormRowCellsSS=$(editFormRowSS).children("TD");if(indexToLookup<=editFormRowCellsSS.length){saveButtonCell=editFormRowCellsSS(indexToLookup);return saveButtonCell;}else{indexToLookup=indexToLookup-editFormRowCellsSS.length;}}saveButtonCell=editFormRowCells[indexToLookup];}return saveButtonCell;};function MetafuseTableFormField(name,cellIndex,valueIndex,formElementId,formCellClientId,defaultValue,dontClearValue,setSelectedWhenEditingUsingValueOrTextForDropDown,onAfterGetFieldText,onAfterGetFieldValue,onBeforeSetFieldValue,onAfterSetFieldValue,valueSeparatorForSet,valueSeparatorForGet,textSeparator,disableOnAdd,disableOnEdit,childMetafuseTableVar){this.Name=name;this.CellIndex=cellIndex;this.ValueIndex=valueIndex;this.DefaultValue=defaultValue;this.FormElementId=formElementId;this.FormCellClientId=formCellClientId;this.ChildMetafuseTableVar=childMetafuseTableVar;this.ChildMetafuseTable=null;this.IsTextValue=(this.ValueIndex==null);this.DontClearValue=dontClearValue;this.ValueSeparatorForSet=",";if(valueSeparatorForSet){this.ValueSeparatorForSet=valueSeparatorForSet;}this.ValueSeparatorForGet=",";if(valueSeparatorForGet){this.ValueSeparatorForGet=valueSeparatorForGet;}if(textSeparator){this.TextSeparator=textSeparator;}this.MissingOptionsToRemove=null;if(setSelectedWhenEditingUsingValueOrTextForDropDown=="1"){this.SetSelectedWhenEditingUsingValueOrTextForDropDown=true;}else{this.SetSelectedWhenEditingUsingValueOrTextForDropDown=false;}this.GetChildMetafuseTable=function(){if(this.ChildMetafuseTableVar!=null){if(this.ChildMetafuseTable==null){this.ChildMetafuseTable=window[this.ChildMetafuseTableVar];}}return this.ChildMetafuseTable;};if(onAfterGetFieldText!=null){this.OnAfterGetFieldText=onAfterGetFieldText;}else{this.OnAfterGetFieldText=function(text,fieldObject){return text;};}if(onAfterGetFieldValue!=null){this.OnAfterGetFieldValue=onAfterGetFieldValue;}else{this.OnAfterGetFieldValue=function(value,fieldObject){return value;};}if(onBeforeSetFieldValue!=null){this.OnBeforeSetFieldValue=onBeforeSetFieldValue;}else{this.OnBeforeSetFieldValue=function(value,text,fieldObject){return true;};}if(onAfterSetFieldValue!=null){this.OnAfterSetFieldValue=onAfterSetFieldValue;}else{this.OnAfterSetFieldValue=function(success,value,text,fieldObject){return success;};}this.DisableOnAdd=false;if(disableOnAdd==1){this.DisableOnAdd=true;$(document).ready(function(){UITools.DisableElement(formElementId);});}this.DisableOnEdit=false;if(disableOnEdit==1){this.DisableOnEdit=true;}};MetafuseTableFormField.prototype.GetFieldValue=MetafuseTableFormField_GetFieldValue;MetafuseTableFormField.prototype.GetFieldText=MetafuseTableFormField_GetFieldText;function MetafuseTableFormField_GetFieldValue(){var value=FormTools.Get(this.FormElementId,this.ValueSeparatorForGet);return this.OnAfterGetFieldValue(value,this);};function MetafuseTableFormField_GetFieldText(){var text=FormTools.GetText(this.FormElementId);return this.OnAfterGetFieldText(text,this);};MetafuseTableFormField.prototype.SetFieldValue=MetafuseTableFormField_SetFieldValue;function MetafuseTableFormField_SetFieldValue(value,text,tableCell){if(this.OnBeforeSetFieldValue(value,text,tableCell,this)){var missingOptionsArray=new Array();var success=true;if(this.FormElementId!=null&&this.FormElementId!=""){success=FormTools.Set(this.FormElementId,value,text,this.ValueSeparatorForSet,this.TextSeparator,missingOptionsArray,false,this.SetSelectedWhenEditingUsingValueOrTextForDropDown);if(!success&&missingOptionsArray.length>0){this.MissingOptionsArray=missingOptionsArray;}}else if(this.FormCellClientId!=null&&this.FormCellClientId!=""){var cell=GetElementById(this.FormCellClientId);if(cell!=null){cell.innerHTML=value;}success=true;}var fieldObject=this;return this.OnAfterSetFieldValue(success,value,text,fieldObject);}else{return true;}};function MetafuseTable_AfterGetDESTimeValue(value,fieldObject){return DES_GetDTTBValue(fieldObject.FormElementId);};function MetafuseTable_BeforeSetDESTimeValue(value,text,tableCell,fieldObject){if(value!=null&&value!=""&&value!="0"){DES_SetDTTBValue(fieldObject.FormElementId,value,2);}else{FormTools.Set(fieldObject.FormElementId,"");}return false;};function MetafuseTable_DurationDaysChanged(element,isDurationElapsedElementId){var durationDays=GetElementById(element);if(durationDays==null){return;}var durationIsElapsed=null;if(isDurationElapsedElementId!=null){durationIsElapsed=GetElementById(isDurationElapsedElementId);}var isElapsed=false;if(durationIsElapsed!=null){if(durationDays.value.indexOf("ed")>=0){if(durationIsElapsed.checked==false){durationIsElapsed.checked=true;}}else if(durationDays.value.indexOf("d")>=0){if(durationIsElapsed.checked==true){durationIsElapsed.checked=false;}}isElapsed=durationIsElapsed.checked;}var durationDaysValue=new Number();durationDaysValue=MathTools.ParseFloat(durationDays.value);durationDaysValue=Math.abs(Math.abs(Round(durationDaysValue,0)));if(durationDays.value!=""){var d="d";if(isElapsed==true){d="ed";}FormTools.Set(durationDays,durationDaysValue+d);}};function MetafuseTable_AfterSetDurationHoursMinutes(success,value,text,fieldObject){if(value!=""){if(value.indexOf("h")>0){value=value.replace("h ",":");value=value.replace("h",":");}else{value="0:"+value;}if(value.indexOf("m")>0){value=value.replace("m","");}else{value+="00";}FormTools.Set(fieldObject.FormElementId,value);}return true;};MetafuseTableFormField.prototype.InsertMissingOptions=MetafuseTableFormField_InsertMissingOptions;function MetafuseTableFormField_InsertMissingOptions(){if(this.MissingOptionsArray!=null&&this.MissingOptionsArray.length>0){for(var i=this.MissingOptionsArray.length-1;i>=0;i--){var option=this.MissingOptionsArray[i];FormTools.InsertFormElementValueAndText(this.FormElementId,option.value,option.text,true,0);}}};MetafuseTableFormField.prototype.RemoveMissingOptions=MetafuseTableFormField_RemoveMissingOptions;function MetafuseTableFormField_RemoveMissingOptions(){if(this.MissingOptionsArray!=null){for(var i=0;i<this.MissingOptionsArray.length;i++){var option=this.MissingOptionsArray[i];FormTools.RemoveFormElementValueAndText(this.FormElementId,option.value,option.text);}}this.MissingOptionsArray=null;};function MetafuseTableRowObjectValue(value,text){this.Value=value;this.Text=text;};function MetafuseTableRowObjectChildObject(id,values,isObjectCreated,isObjectUpdated,isObjectDeleted){var tro=new MetafuseTableRowObject(id,null);tro.Values=values;if(isObjectCreated){tro.IsObjectCreated=true;}if(isObjectUpdated){tro.IsObjectUpdated=true;}if(isObjectDeleted){tro.IsObjectDeleted=true;}return tro;};function MTROCO(id,values){return new MetafuseTableRowObjectChildObject(id,values);};function MetafuseTableRowObject(id,parentId,disableEdit,disableDelete,disableDragDrop){this.Id=id;this.Depth=null;this.RowObjectType=null;this.ParentId=parentId;this.ParentIdOriginal=parentId;this.ParentObject=null;this.RowObjectBeforeCreatedRowId=null;this.DisableEdit=false;if(disableEdit!=null){this.DisableEdit=disableEdit;}this.DisableDelete=false;if(disableDelete!=null){this.DisableDelete=disableDelete;}if(disableDragDrop){this.DisableDragDrop=false;}this.ChartXCoordinates=null;this.MetafuseTable=null;this.IndexAbsolute=0;this.ChildTotalRecursive=0;this.IsObjectCreated=false;this.IsObjectDirty=false;this.IsObjectDeleted=false;this.IsExpanded=false;this.IsChildrenLoaded=false;this.Values=null;this.UpdatedValuesXml=null;this.UpdatedValuesStringByFieldIndexForXml=null;this.RowHiddenFromCollapse=false;};MetafuseTableRowObject.prototype.GetValueByIndex=MetafuseTableRowObject_GetValueByIndex;function MetafuseTableRowObject_GetValueByIndex(index){if(this.Values==null){this.Values=new Array();}if(this.Values.length<index){this.Values[index]=new MetafuseTableRowObjectValue(null,null);}var obj=this.Values[index];if(obj==null){obj=new MetafuseTableRowObjectValue(null,null);this.Values[index]=obj;}else if(isString(obj)){var value=obj;obj=new MetafuseTableRowObjectValue(value,value);this.Values[index]=obj;}return obj;};MetafuseTableRowObject.prototype.ReserializeUpdatedValuesXml=MetafuseTableRowObject_ReserializeUpdatedValuesXml;function MetafuseTableRowObject_ReserializeUpdatedValuesXml(){var metafuseTableFormDefinition=this.MetafuseTable.FormDefinition;var xml="<o id=\""+this.Id+"\"";if(this.IsObjectCreated==true&&this.ParentId!=null&&this.ParentId!=""){xml+=" p=\""+this.ParentId+"\"";}if(this.RowObjectBeforeCreatedRowId!=null){xml+=" a=\""+this.RowObjectBeforeCreatedRowId+"\"";}xml+=">";if(metafuseTableFormDefinition.Fields!=null){for(var i=0;i<metafuseTableFormDefinition.Fields.length;i++){var field=metafuseTableFormDefinition.Fields[i];var childMetafuseTable=field.GetChildMetafuseTable();var valueString=null;if(childMetafuseTable==null){if(field.ValueIndex!=null&&field.ValueIndex>=0){var valueField=this.GetValueByIndex(field.ValueIndex);valueString=valueField.Value;}}if(valueString==null&&this.UpdatedValuesStringByFieldIndexForXml!=null&&this.UpdatedValuesStringByFieldIndexForXml.length>i){valueString=this.UpdatedValuesStringByFieldIndexForXml[i];}if(valueString!=null){if(childMetafuseTable==null){xml+="<f i=\""+i+"\"><![CDATA["+valueString+"]]></f>";}else{xml+="<f i=\""+i+"\">"+valueString+"</f>";}}}}xml+="</o>";this.UpdatedValuesXml=xml;}MetafuseTable.prototype.InsertMetafuseTableRowObjectsFromMetafuseTable=MetafuseTable_InsertRowsFromReceivedTable;function MetafuseTable_InsertRowsFromReceivedTable(receivedTable,parentRow){parentRow=GetElementById(parentRow);var rowToInsertBefore=null;var rowToInsertBeforeSS=null;if(parentRow){parentRow=MetafuseTable_GetRowMainFromElement(parentRow);var rows=MetafuseTable_GetRowAndRelated(parentRow);if(rows&&rows.length>0){var lastRelatedRow=rows[rows.length-1];var nextRow=$(lastRelatedRow).next("TR");if(nextRow&&nextRow.length>0){rowToInsertBefore=nextRow[0];}}}else{if(this.FormDefinition!=null){rowToInsertBefore=this.FormDefinition.GetRowToInsertNewRowBefore();}}if(rowToInsertBefore){rowToInsertBeforeSS=MetafuseTable_GetRowSplitScreenFromElement(rowToInsertBefore);}var parentDepth=null;if(parentRow){parentDepth=MathTools.ParseFloat(UITools.GetPIAttr(parentRow,"depth"));}var metafuseTable=receivedTable;UITools.InsertHTML(metafuseTable.ReceivedTableHtml);var ajaxTableToInsert=GetElementById(metafuseTable.ReceivedTableId);var table=GetElementById(this.ElementId);var tableSS=MetafuseTable_GetTableSplitScreen(table);for(var i=0;i<ajaxTableToInsert.tBodies.length;i++){var tbody=ajaxTableToInsert.tBodies[i];while(tbody.rows.length>0){var r=tbody.rows[0];var ro=metafuseTable.ObjectsById[r.id];tbody.removeChild(r);var rSS=MetafuseTable_GetRowSplitScreenFromElement(r);if(rSS){tbody.removeChild(rSS);}var newDepthAttr=UITools.GetPIAttr(r,"depth");var piId=UITools.GetPIAttr(r,"id");if((newDepthAttr!=null&&newDepthAttr)!=""||(piId!=null&&piId!="")){var newDepth=MathTools.ParseFloat(newDepthAttr);newDepth=newDepth+parentDepth+1;UITools.SetPIAttr(r,"depth",newDepth);if(rSS){UITools.SetPIAttr(rSS,"depth",newDepth);}}if(rowToInsertBefore){$(r).insertBefore(rowToInsertBefore);if(rSS){$(rSS).insertBefore(rowToInsertBeforeSS);}}else{$(table).append(r);if(rSS){$(tableSS).append(rSS);}}if(ro){this.ObjectsById[ro.Id]=ro;}}}ajaxTableToInsert.parentNode.removeChild(ajaxTableToInsert);};MetafuseTable.prototype.AppendObject=MetafuseTable_AppendObject;MetafuseTable.prototype.A=MetafuseTable_AppendObject;function MetafuseTable_AppendObject(id,depth,rowObjectTypeIndex,isExpanded,values){var metafuseTableRowObject=new MetafuseTableRowObject(id,null);metafuseTableRowObject.Depth=depth;if(rowObjectTypeIndex!=null){metafuseTableRowObject.RowObjectType=this.RowObjectTypes[rowObjectTypeIndex];}if(isExpanded){if(isExpanded=="1"||isExpanded=="true"||isExpanded=="True"){metafuseTableRowObject.IsExpanded=true;metafuseTableRowObject.IsChildrenLoaded=true;}}if(this.ChildrenPreLoadedLoadedForCollapsedNodes){metafuseTableRowObject.IsChildrenLoaded=true;}if(values){metafuseTableRowObject.Values=values;}metafuseTableRowObject.MetafuseTable=this;this.ObjectsById[metafuseTableRowObject.Id]=metafuseTableRowObject;};MetafuseTable.prototype.AppendObjectObject=MetafuseTable_AppendObjectObject;function MetafuseTable_AppendObjectObject(metafuseTableRowObject){metafuseTableRowObject.MetafuseTable=this;this.ObjectsById[metafuseTableRowObject.Id]=metafuseTableRowObject;};MetafuseTable.prototype.GetExpandCollapseEventArgument=MetafuseTable_GetExpandCollapseEventArgument;function MetafuseTable_GetExpandCollapseEventArgument(element,isExpand,isLoad){var isCollapseString="true";if(isExpand){isCollapseString="false";}var isLoadString="false";if(isLoad){isLoadString="true";}var row=MetafuseTable_GetRowMainFromElement(element);var table=UITools.GetParentNodeByTagName(row,"TABLE");var rows=$(table).children('tbody').children('tr');var type=UITools.GetPIAttr(row,"type");var topLevelId=row.id
var topLevelType=type;var childrenLoaded=false;if(UITools.GetPIAttr(row,"cl")=="1"){childrenLoaded=true;}var depth=MathTools.ParseFloat(UITools.GetPIAttr(row,"depth"));if(depth>0){var rowIndex=$(row).index();rowIndex=rowIndex-1;while(rowIndex>=0&&depth>0){var parent=rows[rowIndex];if(MetafuseTable_IsExpandCollapse(parent)&&MathTools.ParseFloat(UITools.GetPIAttr(parent,"depth"))==0){topLevelId=parent.id
topLevelType=UITools.GetPIAttr(parent,"type");rowIndex=-1;break;}rowIndex=rowIndex-1;}}var ea='EXPCOL:RowId='+row.id+'&RowType='+type+'&RowDepth='+depth+'&TopRowId='+topLevelId+'&TopRowType='+topLevelType+'&IsLoad='+isLoadString+'&IsCollapse='+isCollapseString+'&IsChildrenLoaded='+childrenLoaded.toString();return ea;};MetafuseTable.prototype.ExpandCollapseObject=MetafuseTable_ExpandCollapseObject;MetafuseTable.prototype.E=MetafuseTable_ExpandCollapseObject;function MetafuseTable_ExpandCollapseObject(element,rowObject,localEventToCancelBubble,deleteAfterExpand){var row=MetafuseTable_GetRowMainFromElement(element);var rowSS=MetafuseTable_GetRowSplitScreenFromElement(row);var table=UITools.GetParentNodeByTagName(row,"TABLE");if(UITools.GetPIAttr(row,"c")=="1"){if(UITools.GetPIAttr(row,"cl")!="1"){var metafuseTable=this;var serverResponse=new MetafuseAjaxPostBackObjectServerResponse();serverResponse.OnAfterExecuteSuccessfulResponse=function(){if(deleteAfterExpand){MetafuseTable_DeleteInvoke(row.id,false,true);}var eventHandlerFunction=UITools.GetPIAttr(table,"javascript-on-after-expand-row");if(eventHandlerFunction!=null&&eventHandlerFunction!=""){Utils.ExecuteFunctionByName(eventHandlerFunction,window,metafuseTable,row,true);}};var eventArgument=MetafuseTable_GetExpandCollapseEventArgument(row,true,true);Ajax.DoAjaxPostBack(MetafuseTable_GetTableUniqueID(row),eventArgument,false,element,"",false,true,serverResponse);}else{UITools.SetPIAttr(row,"c","0");UITools.SetPIAttr(rowSS,"c","0");var index=$(row).index()+1;var startDepth=MathTools.ParseFloat(UITools.GetPIAttr(row,"depth"));var depthToToggle=startDepth+1;var rows=$(table).children('tbody').children('tr');var toggleRowId=UITools.GetPIAttr(row,"id");var expCollapseArray=new Array();expCollapseArray[0]=true;var lastExpandCollapseDepth=depthToToggle;var currentChildNodeExpanded=true;var showRow=false;var lastRowToggledId="";while(index!=null){var toggleRow=rows[index];if(toggleRow==null){index=null;break;}else{var piId=UITools.GetPIAttr(toggleRow,"id");var expandCollapsableRow=MetafuseTable_IsExpandCollapse(toggleRow);if(piId!=null&&piId!=""||expandCollapsableRow){lastRowToggledId=piId;var currentDepth=MathTools.ParseFloat(UITools.GetPIAttr(toggleRow,"depth"));var arrayIndex=currentDepth-depthToToggle;var collapsedAtt=UITools.GetPIAttr(toggleRow,"c");var childLoadedAtt=UITools.GetPIAttr(toggleRow,"children-loaded");if(expandCollapsableRow||(collapsedAtt!=null&&collapsedAtt!="")){if(collapsedAtt!="1"){expCollapseArray[arrayIndex+1]=true;}else{expCollapseArray[arrayIndex+1]=false;}}showRow=false;if(expCollapseArray.length>arrayIndex){showRow=expCollapseArray[arrayIndex];}if(showRow){MetafuseTable_ToggleDisplay(toggleRow,false);UITools.SetPIAttr(toggleRow,"display-none-collapse","");}else if(currentDepth<depthToToggle){index=null;break;}}else if(showRow){var relatedId=UITools.GetPIAttr(toggleRow,"id-related");if(relatedId!=null&&relatedId!=""&&relatedId==lastRowToggledId&&relatedId!=toggleRowId){MetafuseTable_ToggleDisplay(toggleRow,false);UITools.SetPIAttr(toggleRow,"display-none-collapse","");}}}if(index!=null){index+=1;}}var img=$(row).find('.ExpCol');if((img==null||img.length==0)&&rowSS!=null){img=$(rowSS).find('.ExpCol');}if(img&&img.length>0){img[0].src=MFImg.ItemOpenArrow;}if(!this.DisableAjaxPostBackOnExpandCollapseAfterChildrenLoaded){var eventArgument=MetafuseTable_GetExpandCollapseEventArgument(row,true,false);Ajax.DoAjaxPostBack(this.UniqueId,eventArgument);}var eventHandlerFunction=UITools.GetPIAttr(table,"javascript-on-after-expand-row");if(eventHandlerFunction!=null&&eventHandlerFunction!=""){Utils.ExecuteFunctionByName(eventHandlerFunction,window,this,row,false);}if(deleteAfterExpand){MetafuseTable_DeleteInvoke(row.id,false,true);}}}else{UITools.SetPIAttr(row,"c","1");UITools.SetPIAttr(rowSS,"c","1");var index=$(row).index()+1;var depthToToggle=MathTools.ParseFloat(UITools.GetPIAttr(row,"depth"))+1;var toggleRowId=UITools.GetPIAttr(row,"id");var rows=$(table).children('tbody').children('tr');while(index!=null){var toggleRow=rows[index];if(toggleRow==null){index=null;break;}else{var piId=UITools.GetPIAttr(toggleRow,"id");var expandCollapsableRow=MetafuseTable_IsExpandCollapse(toggleRow);if(piId!=null&&piId!=""||expandCollapsableRow){var currentDepth=MathTools.ParseFloat(UITools.GetPIAttr(toggleRow,"depth"));if(currentDepth>=depthToToggle){UITools.SetPIAttr(toggleRow,"display-none-collapse","1");MetafuseTable_ToggleDisplay(toggleRow,true);}else if(currentDepth<depthToToggle){index=null;break;}}else{var relatedId=UITools.GetPIAttr(toggleRow,"id-related");if(relatedId!=null&&relatedId!=""&&relatedId!=toggleRowId){UITools.SetPIAttr(toggleRow,"display-none-collapse","1");MetafuseTable_ToggleDisplay(toggleRow,true);}}}if(index!=null){index+=1;}}var img=$(row).find('.ExpCol');if((img==null||img.length==0)&&rowSS!=null){img=$(rowSS).find('.ExpCol');}if(img&&img.length>0){img[0].src=MFImg.ItemClosedArrow;}if(!this.DisableAjaxPostBackOnExpandCollapseAfterChildrenLoaded){var eventArgument=MetafuseTable_GetExpandCollapseEventArgument(row,false,false);var serverResponse=new MetafuseAjaxPostBackObjectServerResponse();Ajax.DoAjaxPostBack(MetafuseTable_GetTableUniqueID(row),eventArgument,false,null,"",false,false,serverResponse);}var eventHandlerFunction=UITools.GetPIAttr(table,"javascript-on-after-collapse-row");if(eventHandlerFunction!=null&&eventHandlerFunction!=""){Utils.ExecuteFunctionByName(eventHandlerFunction,window,this,row);}}if(localEventToCancelBubble){UITools.CancelBubble(localEventToCancelBubble);}return false;};function MetafuseTable_IsExpandCollapse(row){row=GetElementById(row);if(row!=null){if(UITools.GetPIAttr(row,"group-by")=="1"||UITools.GetPIAttr(row,"expand-collapse")=="1"){return true;}}return false;};function MetafuseTable_GetTableUniqueID(element){element=GetElementById(element);var uid="";if(element){var table=MetafuseTable_GetTableMain(element);uid=UITools.GetPIAttr(table,"unique-id");}return uid;};function MetafuseTable_GetTableMain(element,excludeComboBoxes){if(element!=null&&isObject(element)&&element["MetafuseTable"]){element=GetElementById(element.MetafuseTable["ClientID"]);if(element){return element;}}element=GetElementById(element);if(element){var t=UITools.GetParentNodeByTagName(element,"TABLE");if(t!=null){if(excludeComboBoxes&&FormTools.GetFormElementType(t)=="MetafuseComboBox"){return MetafuseTable_GetTableMain(t.parentNode);}var id=UITools.GetPIAttr(t,"split-screen-main-id");if(id!=""){var m=GetElementById(id);return m;}else{return t;}}}return null;};function MetafuseTable_GetTableSplitScreen(element){var t=MetafuseTable_GetTableMain(element);if(t){var id=UITools.GetPIAttr(t,"split-screen-left-id");if(id!=""){var s=GetElementById(id);return s;}else{return t;}}return null;};function MetafuseTable_GetJSObject(element){var table=MetafuseTable_GetTableMain(element);if(table){return window[UITools.GetPIAttr(table,"js-obj-id")];}return null;};function MetafuseTable_GetRowMainFromElement(element){var rowSS=GetElementById(element);if(rowSS!=null){rowSS=UITools.GetParentNodeByTagName(rowSS,"TR");var suffix="_ss";if(rowSS.id.endsWith(suffix)){var id=rowSS.id.substring(0,rowSS.id.lastIndexOf(suffix));var row=GetElementById(id);if(row!=null){return row;}}return rowSS;}return null;};function MetafuseTable_GetRowSplitScreenFromElement(element){var row=GetElementById(element);if(row!=null){row=UITools.GetParentNodeByTagName(row,"TR");var suffix="_ss";if(row.id.endsWith(suffix)){return row;}else{var id=row.id+suffix;var rowSS=GetElementById(id);if(rowSS!=null){return rowSS;}}}return null;};MetafuseTable.prototype.InsertExpandedRows=MetafuseTable_InsertExpandedRows;function MetafuseTable_InsertExpandedRows(metafuseTable,expandId){var row=MetafuseTable_GetRowMainFromElement(expandId);var rowSS=MetafuseTable_GetRowSplitScreenFromElement(row);UITools.SetPIAttr(row,"cl","1");UITools.SetPIAttr(rowSS,"cl","1");UITools.SetPIAttr(row,"c","0");UITools.SetPIAttr(rowSS,"c","0");var metafuseTableRowObject=this.ObjectsById[expandId];this.InsertMetafuseTableRowObjectsFromMetafuseTable(metafuseTable,row);var anchor=null;var img=$(row).find('.ExpCol');if((img==null||img.length==0)&&rowSS!=null){img=$(rowSS).find('.ExpCol');}if(img&&img.length>0){img[0].src=MFImg.ItemOpenArrow;}};function MetafuseTable_GetRowsWithID(element){var table=MetafuseTable_GetTableMain(element);if(table){var a=new Array();var rows=$(table).children("tbody").children("tr");for(var i=0;i<rows.length;i++){var r=rows[i];if(UITools.GetPIAttr(r,"id")!=""){a[a.length]=r;}}return a;}return new Array();};function MetafuseTable_ExpandAll(forGroupBy,tableId,disableAJAXcallback){if(tableId==null){tableId=this.ElementId;}var table=GetElementById(tableId);if(table){if(forGroupBy){var idsExpandAll="";var toggleRowId="";var rows=$(table).children('tbody').children('tr');for(var i=0;i<rows.length;i++){var toggleRow=rows[i];var piId=UITools.GetPIAttr(toggleRow,"id");var expandCollapsableRow=MetafuseTable_IsExpandCollapse(toggleRow);if(piId!=null&&piId!=""||expandCollapsableRow){if(idsExpandAll!=""){idsExpandAll+=",";}idsExpandAll+=piId;var currentDepth=MathTools.ParseFloat(UITools.GetPIAttr(toggleRow,"depth"));if(expandCollapsableRow){if(currentDepth==0){toggleRowId=piId;}var img=$(toggleRow).find('.ExpCol');UITools.SetPIAttr(toggleRow,"c","0");var rowSS=MetafuseTable_GetRowSplitScreenFromElement(toggleRow);if(rowSS){UITools.SetPIAttr(rowSS,"c","0");}if((img==null||img.length==0)&&rowSS!=null){img=$(rowSS).find('.ExpCol');}if(img&&img.length>0){img[0].src=MFImg.ItemOpenArrow;}}if(currentDepth>0){MetafuseTable_ToggleDisplay(toggleRow,false);}}else{var relatedId=UITools.GetPIAttr(toggleRow,"id-related");if(relatedId!=null&&relatedId!=""&&relatedId!=toggleRowId){MetafuseTable_ToggleDisplay(toggleRow,false);}}}}if(!disableAJAXcallback){var uniqueID=MetafuseTable_GetTableUniqueID(table);if(idsExpandAll!=""){idsExpandAll=":"+idsExpandAll;}if(uniqueID!=null&&uniqueID!=""){Ajax.DoAjaxPostBack(uniqueID,'ExpandAll'+idsExpandAll,false,table,"",false,true);}}}return false;};function MetafuseTable_CollapseAll(tableId,disableAJAXcallback){if(tableId==null){tableId=this.ElementId;}var table=GetElementById(tableId);if(table){var toggleRowId="";var rows=$(table).children('tbody').children('tr');for(var i=0;i<rows.length;i++){var toggleRow=rows[i];var piId=UITools.GetPIAttr(toggleRow,"id");var expandCollapsableRow=MetafuseTable_IsExpandCollapse(toggleRow);if(piId!=null&&piId!=""||expandCollapsableRow){var currentDepth=MathTools.ParseFloat(UITools.GetPIAttr(toggleRow,"depth"));if(expandCollapsableRow){if(currentDepth==0){toggleRowId=piId;}var img=$(toggleRow).find('.ExpCol');UITools.SetPIAttr(toggleRow,"c","1");var rowSS=MetafuseTable_GetRowSplitScreenFromElement(toggleRow);if(rowSS){UITools.SetPIAttr(rowSS,"c","1");}if((img==null||img.length==0)&&rowSS!=null){img=$(rowSS).find('.ExpCol');}if(img&&img.length>0){img[0].src=MFImg.ItemClosedArrow;}}if(currentDepth>0){MetafuseTable_ToggleDisplay(toggleRow,true);}}else{var relatedId=UITools.GetPIAttr(toggleRow,"id-related");if(relatedId!=null&&relatedId!=""&&relatedId!=toggleRowId){MetafuseTable_ToggleDisplay(toggleRow,true);}}}if(!disableAJAXcallback){var uniqueID=MetafuseTable_GetTableUniqueID(table);if(uniqueID!=null&&uniqueID!=""){Ajax.DoAjaxPostBack(uniqueID,'CollapseAll',false,null,"",false,true);}}}return false;};MetafuseTable.prototype.AjaxCall=MetafuseTable_AjaxCall;MetafuseTable.prototype.APB=MetafuseTable_AjaxCall;function MetafuseTable_AjaxCall(eventArgument,element,confirmMessage,showProcessing,causesValidation){var processingNear=null;var confirmSuccess=true;if(confirmMessage){confirmSuccess=confirm(confirmMessage);}if(confirmSuccess){if(element&&showProcessing){processingNear=GetElementById(element);}if(element){var row=this.GetRowContainingElement(element);if(row){var key=this.GetRowKey(row);var id=this.RemoveNamingContainerIdFromRowId(key);eventArgument+=":"+id;}}Ajax.DoAjaxPostBack(this.UniqueId,eventArgument,causesValidation,processingNear,"",false,true);}return false;};MetafuseTable.prototype.DisableTotalRows=MetafuseTable_DisableTotalRows;function MetafuseTable_DisableTotalRows(tableId){if(tableId==null){tableId=this.ElementId;}var table=MetafuseTable_GetTableMain(tableId);var table_ss=GetElementById(tableId+"_ss");var rows=$(table).children('tbody').children('tr');for(var i=0;i<rows.length;i++){var row=rows[i];if(row.className.indexOf("TotalRow")>=0||row.className.indexOf("GroupByRow")>=0||row.className.indexOf("GroupByRow1")>=0||row.className.indexOf("GroupByRow2")>=0||row.className.indexOf("SubTotalRow")>=0||row.className.indexOf("SubTotalRow1")>=0||row.className.indexOf("SubTotalRow2")>=0||row.className.indexOf("TotalRowAlt")>=0||row.className.indexOf("GroupByRowAlt")>=0||row.className.indexOf("GroupByRow1Alt")>=0||row.className.indexOf("GroupByRow2Alt")>=0||row.className.indexOf("SubTotalRowAlt")>=0||row.className.indexOf("SubTotalRow1Alt")>=0||row.className.indexOf("SubTotalRow2Alt")>=0){row.className=row.className+=" DE";if(table_ss&&row.id!=""){var row_ss=GetElementById(row.id+"_ss");if(row_ss){row_ss.className=row_ss.className+=" DE";}}}}UITools.ToggleDisplay(tableId+"_refreshTable",false);UITools.ToggleDisplay(tableId+"_refreshTableBottom",false);};MetafuseTable.prototype.H=MetafuseTable_Highlight;MetafuseTable.prototype.Highlight=MetafuseTable_Highlight;function MetafuseTable_Highlight(row,enableDynamicDisplay){row=GetElementById(row);if(row==null){return;}var tableMain=MetafuseTable_GetTableMain(row);var id=MetafuseTable_GetRowKey(row);UITools.SetPIAttr(tableMain,"row-over-id",id);var rowSS=GetElementById(id+"_ss");var ah=null;var hla=MetafuseTable_GetRelatedSuffixesHighlightArray(tableMain);if(hla!=null||row.id!=id||rowSS!=null){ah=new Array();if(hla){for(var i=0;i<hla.length;i++){var suffix=hla[i];var rRowId=id+suffix;ah[ah.length]=rRowId;if(rowSS){ah[ah.length]=rRowId+"_ss";}}}if(row.id!=id){ah[ah.length]=id;}if(rowSS&&rowSS.id!=row.id){ah[ah.length]=id+"_ss";}}HOn(row,enableDynamicDisplay,ah);if(this.ContextMenus){var $row=$(row);if($row.data("oncontextmenuset")!=true&&$row.hasClass("TotalRow")==false){var contextMenuName=null;if(this.RowObjectTypes){var tro=this.ObjectsById[id];var type=this.RowObjectTypes[tro.RowObjectType];contextMenuName=this.ContextMenus[type];}else{contextMenuName=this.ContextMenus["0"];}if(contextMenuName!=null){AddEventHandlerToElement(row,'oncontextmenu',new Function("event",this.ObjectId+".ShowContextMenuForRow("+contextMenuName+",event,'"+id+"')"));$row.data("oncontextmenuset",true);}}}if(this.FormDefinition!=null&&GetElementById(this.FormDefinition.FormRowId)!=null&&$(row).data("ondblclickset")!=true){if(UITools.GetPIAttr(row,"de")!="1"){AddEventHandlerToElement(row,'ondblclick',new Function("event","MetafuseTable_Edit('"+id+"');"));}$(row).data("ondblclickset",true);}if((UITools.GetPIAttr(tableMain,"enable-drag-drop-row")=="1"||UITools.GetPIAttr(tableMain,"enable-drag-drop-row-ajax")=="1")&&$(row).data("onmousedownset")!=true){var rowMain=MetafuseTable_GetRowMainFromElement(row);if(rowMain!=null&&UITools.GetPIAttr(rowMain,"id")!=""&&UITools.GetPIAttr(row,"disable-drag-drop")!="1"){AddEventHandlerToElement(row,'onmousedown',new Function("event","MetafuseTable_RowMoveSelectOnMouseDown('"+id+"',event);"));}$(row).data("onmousedownset",true);}if(UITools.GetPIAttr(tableMain,"disable-cell-auto-tool-tip-hover")!="1"){if(row.cells.length>0&&row.cells[0].title==""){var tableHeader=UITools.GetParentNodeByTagName(row,"TABLE");if(row.id.indexOf("_ss")==row.id.length-3){if(UITools.GetPIAttr(tableMain,"split-screen-left-header-id")!=""){tableHeader=GetElementById(UITools.GetPIAttr(tableMain,"split-screen-left-header-id"));}}else{if(UITools.GetPIAttr(tableMain,"split-screen-main-header-id")!=""){tableHeader=GetElementById(UITools.GetPIAttr(tableMain,"split-screen-main-header-id"));}}var thRow;var hasbody=false;if(tableHeader.tBodies[0]!=null){thRow=tableHeader.tBodies[0].rows[0];hasbody=true;}var n=MetafuseTable_GetRowName(row);for(var i=0;i<row.cells.length;i++){var c=row.cells[i];if(c.title==""){var cn="";if(hasbody){if(i<thRow.cells.length){var hc=thRow.cells[i];if(hc.tagName=="TH"){if(hc.textContent){cn=hc.textContent;}else if(BrowserTools.IsInternetExplorer()){cn=hc.innerText;}}}}var ts="";if(n!=""){ts="Row:  "+n;}if(cn!=""){if(ts!=""){ts+="\n";}ts+=" Col:  "+cn;}if(ts!=""){c.title=ts;}else if(i==0){c.title=" ";}}}}}};MetafuseTable.prototype.AddContextMenu=MetafuseTable_AddContextMenu;function MetafuseTable_AddContextMenu(contextMenu,rowType){if(this.ContextMenus==null){this.ContextMenus=new Object();}this.ContextMenus[rowType]=contextMenu;}MetafuseTable.prototype.ShowContextMenuForRow=MetafuseTable_ShowContextMenuForRow;function MetafuseTable_ShowContextMenuForRow(contextMenu,localEvent,rowId,x,y){var row=GetElementById(rowId);row=MetafuseTable_GetRowMainFromElement(row);var table=MetafuseTable_GetTableMain(row);UITools.SetPIAttr(table,"context-menu-row-id",row.id);this.RowIdContextMenu=rowId;if(this.OnBeforeShowContextMenuForRow(this,contextMenu,localEvent,rowId)){contextMenu.ContextMenuShow(localEvent,x,y);if(row!=null){$(row).removeClass("RowHighlight");$(row).addClass("RowContext");contextMenu.OnAfterHideContextMenu=function(){$(row).removeClass("RowContext");}}}}function MetafuseTable_GetIdsArrayForAllEntriesChecked(tableId){var taskIds=new Array();var $checkboxes=$("#"+tableId+" input[name='"+tableId+"__e']:checked");$checkboxes.each(function(){taskIds.push($(this).val());});return taskIds;};function MetafuseTable_ToggleAllEntriesChecked(isChecked,tableElementId){var checkboxes=document.forms[0][tableElementId+'__e'];if(checkboxes){if(checkboxes.length&&checkboxes.length>1){for(var i=0;i<checkboxes.length;i++){var checkbox=checkboxes[i];checkbox.checked=isChecked;}}else{checkboxes.checked=isChecked;}}};function MT_EC(element){if(element.checked==false){var tableElementId=element.id.replace('__e','');var allCheckbox=GetElementById(tableElementId+'__eAll');if(allCheckbox){allCheckbox.checked=false;}}};function MetafuseTable_ToggleSplitScreen(localEvent,contextMenu,tableId,tableColumnSelectorId,splitScreenSelectorId,tableRefreshButtonId,value){if(!splitScreenSelectorId&&tableColumnSelectorId){splitScreenSelectorId=tableColumnSelectorId+"_splitScreen";}splitScreenSelectorId=GetElementById(splitScreenSelectorId);if(splitScreenSelectorId){if(value=="2"&&tableColumnSelectorId!=null){var tso=window[tableColumnSelectorId+"o"];if(tso){var availableColumns=GetElementById(tableColumnSelectorId+"_availableColumnsListBox");var selectedColumns=GetElementById(tableColumnSelectorId+"_selectedColumnsListBox");if(availableColumns&&selectedColumns){var drag=new MetafuseGenericDragObject();drag.MousePageXCoordinate=contextMenu.ShowContextMenuMousePageXCoordinate;drag.MousePageYCoordinate=contextMenu.ShowContextMenuMousePageYCoordinate;if(selectedColumns.options){var setNextCell=false;for(var i=0;i<selectedColumns.options.length;i++){var option=selectedColumns.options[i];if(setNextCell){if(option.value!="--"){FormTools.Set(selectedColumns,"");if(FormTools.Set(selectedColumns,"--")){tso.RemoveTableColumns(false);}FormTools.Set(selectedColumns,option.value);if(FormTools.Set(availableColumns,"--")){tso.AddTableColumns(false);}}setNextCell=false;break;}var cell=GetElementById("cs_"+option.value);if(!cell){cell=GetElementById(tableId+"_cs_"+option.value);}if(cell){if(drag.IsMouseOverElement(cell)){setNextCell=true;if((i+1)==selectedColumns.options.length){if(option.value!="--"){FormTools.Set(selectedColumns,"");if(FormTools.Set(selectedColumns,"--")){tso.RemoveTableColumns(false);}FormTools.Set(selectedColumns,"");if(FormTools.Set(availableColumns,"--")){tso.AddTableColumns(false);}}}}}}}}}}FormTools.Set(splitScreenSelectorId,value);if(tableRefreshButtonId){$(GetElementById(tableRefreshButtonId)).click();}else{MAPBB(tableId,'REFRESHTABLE',false,tableId,false,false,null);}}};MetafuseTable.prototype.ToggleDisplay=MetafuseTable_ToggleDisplay;function MetafuseTable_ToggleDisplay(row,hide,includeRelatedRows){row=GetElementById(row);if(row){var table=UITools.GetParentNodeByTagName(row,"TABLE");var splitScreenRowSuffix="_ss";var rowSS=null;if(splitScreenRowSuffix!=null&&splitScreenRowSuffix!=""){if(row.id.endsWith(splitScreenRowSuffix)){rowSS=row;row=GetElementById(rowSS.id.substring(0,row.id.lastIndexOf(splitScreenRowSuffix)));}else{rowSS=GetElementById(row.id+splitScreenRowSuffix);}}UITools.ToggleDisplay(row,hide);if(rowSS!=null){UITools.ToggleDisplay(rowSS,hide);}if(includeRelatedRows){var a=MetafuseTable_GetRelatedSuffixesArray(row);if(a!=null&&a.length>0){for(var i=0;i<a.length;i++){var suffix=a[ii];var relatedRowId=row.id+suffix;var relatedRow=GetElementById(relatedRowId);if(relatedRow){UITools.ToggleDisplay(relatedRowId,hide);UITools.ToggleDisplay(relatedRowId+"_ss",hide);}}}}}};function MetafuseTable_GetParentRow(row){row=GetElementById(row);row=UITools.GetParentNodeByTagName(row,"TR");if(row){var idParent=UITools.GetPIAttr(row,"id-parent");var table=MetafuseTable_GetTableMain(row,"TABLE");var rows=$(table).children('tbody').children('tr');var index=$(row).index();index=index-1;var depth=MathTools.ParseFloat(UITools.GetPIAttr(row,"depth"));while(index>=0){var r=rows[index];var id=UITools.GetPIAttr(r,"id");if(id!=null&&id!=""){if(idParent!=""&&id==idParent){return r;}var rd=MathTools.ParseFloat(UITools.GetPIAttr(r,"depth"));if(rd<depth){return r;}}index=index-1;}}return null;};function MetafuseTable_GetRowAndRelatedAndChildren(element,excludeParentRowAndRelated){var rows=new Array();var row=MetafuseTable_GetRowMainFromElement(element);if(row){var currentId="";if(!excludeParentRowAndRelated){rows[rows.length]=row;currentId=UITools.GetPIAttr(row,"id");}var table=MetafuseTable_GetTableMain(row);var startDepth=MathTools.ParseFloat(UITools.GetPIAttr(row,"depth"));var childOrRelated=$(row).next('tr');if(childOrRelated.length>0){childOrRelated=childOrRelated[0];}else{childOrRelated=null;}while(childOrRelated){var piId=UITools.GetPIAttr(childOrRelated,"id");if(piId!=null&&piId!=""){var currentDepth=MathTools.ParseFloat(UITools.GetPIAttr(childOrRelated,"depth"));currentId=piId;if(currentDepth>startDepth){rows[rows.length]=childOrRelated;}else if(currentDepth<=startDepth){childOrRelated=null;break;}}else{var relatedId=UITools.GetPIAttr(childOrRelated,"id-related");if(relatedId!=null&&relatedId!=""&&relatedId==currentId){rows[rows.length]=childOrRelated;}}childOrRelated=$(childOrRelated).next('tr');if(childOrRelated.length>0){childOrRelated=childOrRelated[0];}else{childOrRelated=null;}}}return rows;};function MetafuseTable_GetRowAndRelated(element){var rows=new Array();var row=MetafuseTable_GetRowMainFromElement(element);if(row){rows[rows.length]=row;var table=MetafuseTable_GetTableMain(row);var startDepth=MathTools.ParseFloat(UITools.GetPIAttr(row,"depth"));var currentId=UITools.GetPIAttr(row,"id");var related=$(row).next('tr');if(related.length>0){related=related[0];}else{related=null;}while(related){var relatedId=UITools.GetPIAttr(related,"id-related");if(relatedId!=null&&relatedId!=""&&relatedId==currentId){rows[rows.length]=related;related=$(related).next('tr');if(related.length>0){related=related[0];}else{related=null;}}else{related=null;}}}return rows;};function MetafuseTable_GetRowChildrenAndRelated(element){return MetafuseTable_GetRowAndRelatedAndChildren(element,true);};function MetafuseTable_GetRowByIDAttr(element,id){element=GetElementById(element);if(element.tagName=="TR"&&UITools.GetPIAttr(element,"id")==id){return element;}else{var table=MetafuseTable_GetTableMain(element);if(table!=null){var row=$(table).children("tbody").children("[data-pi-id='"+id+"']");var r;if(row&&row.length>0){r=row[0];}return MetafuseTable_GetRowMainFromElement(r);}}return null;};function MetafuseTable_GetTableAllRowIDs(element){var table=MetafuseTable_GetTableMain(element);var array=new Array();if(table){var rows=$(table).children("tbody").children('[data-pi-id]');for(var i=0;i<rows.length;i++){var row=rows[i];var id=UITools.GetPIAttr(row,"id");if(id!=null&&id!=""){array[array.length]=id;}}}return array;};function MetafuseTable_GetRelatedSuffixesArray(element){var table=MetafuseTable_GetTableMain(element);var sAttr=UITools.GetPIAttr(table,"id-related-suffixes")
if(sAttr!=""){var a=sAttr.split(",");if(a!=null&&a.length>0){return a;}}return null;};function MetafuseTable_GetRelatedSuffixesHighlightArray(element){var table=MetafuseTable_GetTableMain(element);var sAttr=UITools.GetPIAttr(table,"id-related-suffixes-highlight")
if(sAttr!=""){var a=sAttr.split(",");if(a!=null&&a.length>0){return a;}}return null;};function MetafuseTable_InsertFormRowAfter(row){var row=MetafuseTable_GetRowMainFromElement(row);var table=MetafuseTable_GetTableMain(row);var formRowId=UITools.GetPIAttr(table,"form-row-id");var formRow=GetElementById(formRowId);var formRowSS=GetElementById(formRowId+"_ss");if(formRow){var rows=MetafuseTable_GetRowAndRelated(row);if(rows!=null&&rows.length>0){var insertAfter=rows[rows.length-1];$(formRow).insertAfter(insertAfter);if(formRowSS){insertAfterSS=GetElementById(insertAfter.id+"_ss");if(insertAfterSS){$(formRowSS).insertAfter(insertAfterSS);}}}}};function MetafuseTable_UpdateExpandCollapseCellPadding(row){row=MetafuseTable_GetRowMainFromElement(row);if(!row){return;}var table=MetafuseTable_GetTableMain(row);if(table){var rowSS=MetafuseTable_GetRowSplitScreenFromElement(row);var expandCollapseCellIndex=UITools.GetPIAttr(table,"expand-collapse-cell-index");if(expandCollapseCellIndex!=null&&expandCollapseCellIndex!=""){var r=row;var index=MathTools.ParseFloat(expandCollapseCellIndex);if(rowSS){if(index<rowSS.cells.length){r=rowSS}else{index=index-rowSS.cells.length;}}var cell=r.cells[index];var depth=MathTools.ParseFloat(UITools.GetPIAttr(row,"depth"));var ecCellPadding=2;var ecDepthPadding=20;var ecArrowWidth=16;var img=$(r).find('.ExpCol');var padding=ecCellPadding;padding+=(depth*ecDepthPadding);if(!img||img.length==0){padding+=ecArrowWidth;}var paddingLeftString=padding.toString()+"px";cell.style.paddingLeft=paddingLeftString;}}};function MetafuseTable_GetTableHeaderCells(table){table=MetafuseTable_GetTableMain(table);var tableHeader=table;if(UITools.GetPIAttr(table,"split-screen-main-header-id")!=""){tableHeader=GetElementById(UITools.GetPIAttr(table,"split-screen-main-header-id"));}if(tableHeader){var rows=$(tableHeader).children('tbody').children('tr');for(var i=0;i<rows.length;i++){var row=rows[i];var headerCells=$(row).children('th');if(headerCells!=null&&headerCells.length>0){return MetafuseTable_GetCellsForRow(row);}}};return null;};function MetafuseTable_GetCellsForRow(element){var row=MetafuseTable_GetRowMainFromElement(element);var rowSS=MetafuseTable_GetRowSplitScreenFromElement(row);var all=new Array();if(rowSS!=null){if(rowSS.childNodes){for(var i=0;i<rowSS.childNodes.length;i++){var child=rowSS.childNodes[i];if((child.tagName="TD"&&child.nodeName=="TD")||(child.tagName=="TH"&&child.nodeName=="TH")){all[all.length]=child;}}}}if(row!=null){if(row.childNodes){for(var i=0;i<row.childNodes.length;i++){var child=row.childNodes[i];if((child.tagName="TD"&&child.nodeName=="TD")||(child.tagName=="TH"&&child.nodeName=="TH")){all[all.length]=child;}}}}return all;};function MetafuseTable_GetCellIndexByColumnName(element,tablePIColumnName){var cellIndex=-1;var cells=MetafuseTable_GetTableHeaderCells(element);if(cells!=null){for(var i=0;i<cells.length;i++){var cell=cells[i];cellIndex+=1;if(UITools.GetPIAttr(cell,"column")==tablePIColumnName){return cellIndex;}if(cell.colSpan>1){cellIndex+=cell.colSpan-1;}}}return-1;};function MetafuseTable_GetCellByColumnName(row,tablePIColumnName){var tbl=MetafuseTable_GetTableMain(row);var cellIndex=this.MetafuseTable_GetCellIndexByColumnName(tbl,tablePIColumnName);if(cellIndex>=0){var allFooterCells=MetafuseTable_GetCellsForRow(row);var cellSpan=0;if(allFooterCells.length>0){for(i=0;i<=(cellIndex-cellSpan);i++){var cell=allFooterCells[i];if(i==(cellIndex-cellSpan)){return allFooterCells[cellIndex-cellSpan];}if(cell.colSpan>1){cellSpan+=cell.colSpan-1;}}}}};