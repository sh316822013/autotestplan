function MetafusePortalControlContainer(clientID,uniqueID,columnCount){this.ClientID=clientID;this.UniqueID=uniqueID;this.ColumnCount=columnCount;this.RowDragObject=null;this.RowDragTable=null;this.RowDragTableShim=null;this.AfterControlMoved=function(){};this.StartDragOnClickFunction=null;this.StartDragOnClickMouseDown=false;this.StartDragOnClickDelay=1000;this.TouchStartBegan=false;};MetafusePortalControlContainer.prototype.DragPortalControl=MetafusePortalControlContainer_DragPortalControl;function MetafusePortalControlContainer_DragPortalControl(localEvent,element,onclickfunction){if(localEvent.type.toString().indexOf("touch")<0&&this.TouchStartBegan){return;}else if(localEvent.type.toString().indexOf("touch")>=0){this.TouchStartBegan=true;}var parentNode=element.parentNode;var rowToMove=this.GetRowContainingElement(element);var portalContainerRowToMove=null;if(rowToMove==null){return;}else{var parentNode=rowToMove;while(parentNode!=null){if(parentNode.nodeName=="TR"&&parentNode.id.indexOf(this.ClientID)>=0&&parentNode.id.indexOf("_Row")>0){portalContainerRowToMove=parentNode;break;}parentNode=parentNode.parentNode;}}if(portalContainerRowToMove==null){return;}if(this.RowDragObject==null){this.RowDragObject=new MetafuseGenericDragObject();}var cell=$(rowToMove).children(".pi-left-nav-title")[0];this.RowDragTable=this.RowDragObject.GetGenericDragDiv($(cell).text());var self=this;var rowDragObject=this.RowDragObject;this.RowDragObject.OnAfterStopDrag=function(rowDragObject){self.TouchStartBegan=false;UITools.HideDivAndIFrame(self.RowDragTable,self.RowDragTableShim);var tableOver=null;var column=null;for(var i=0;i<self.ColumnCount;i++){var t=GetElementById(self.ClientID+"_"+i);if(this.IsMouseOverElement(t)){tableOver=t;column=i;break;}}if(tableOver){var tBodies=tableOver.getElementsByTagName("TBODY");var tBody=tBodies[0];var rowOver=null;var rowNumber=null;for(var i=0;i<tBody.childNodes.length;i++){var row=tBody.childNodes[i];if(this.IsMouseOverElement(row)){rowOver=row;rowNumber=i;break;}}var insertBeforeRow=null;if(rowOver){if(rowOver==portalContainerRowToMove){return;}var rowOverYT=UITools.GetPageYCoordinate(rowOver);var rowOverYB=rowOverYT+(rowOver.offsetHeight/2);if(this.MousePageYCoordinate<rowOverYB){insertBeforeRow=rowOver;}else{insertBeforeRow=rowOver.nextSibling;}}if(insertBeforeRow){if(insertBeforeRow==portalContainerRowToMove){return;}portalContainerRowToMove.parentNode.removeChild(portalContainerRowToMove);tBody.insertBefore(portalContainerRowToMove,insertBeforeRow);}else{portalContainerRowToMove.parentNode.removeChild(portalContainerRowToMove);tBody.appendChild(portalContainerRowToMove);}var hiddenValue="";var prefix=self.ClientID+"_Row_";for(var i=0;i<self.ColumnCount;i++){if(hiddenValue!=""){hiddenValue!="|";}var controlOrder="";var table=GetElementById(self.ClientID+"_"+i);tBodies=table.getElementsByTagName("TBODY");tBody=tBodies[0];for(var ii=0;ii<tBody.childNodes.length;ii++){var row=tBody.childNodes[ii];if(row.id.indexOf(prefix)>=0){if(controlOrder!=""){controlOrder+=",";}controlOrder+=row.id.substring(prefix.length);}}if(controlOrder!=""){hiddenValue+=controlOrder;}}FormTools.SetFormElementValue(self.ClientID+"l",hiddenValue);self.AfterControlMoved();Ajax.DoAjaxPostBack(self.UniqueID,"move:"+hiddenValue,false,null,"",false,false,null);}};this.RowDragObject.StartDragOnClick(localEvent,this.RowDragTable,onclickfunction);return false;};MetafusePortalControlContainer.prototype.AddControl=MetafusePortalControlContainer_AddControl;function MetafusePortalControlContainer_AddControl(element,id,requiresPostBack){var row=GetElementById(id+"_ControlRow");if(row){if(row.style.display=="none"){var tBody=row.parentNode;tBody.removeChild(row);var lt=GetElementById("lt");var tBodies=lt.getElementsByTagName("TBODY");tBody=tBodies[0];tBody.appendChild(row);UITools.ToggleDisplay(row,false);Ajax.DoAjaxPostBack("addControl","false|"+id,false,null,"",false,false,null);}else{alert("The control you selected is already on the page.");}}else{if(!requiresPostBack&&!disableAjaxPostBackOnAddControl){var ts=new Date().valueOf().toString();var serverResponse=new MetafuseAjaxPostBackObjectServerResponse();serverResponse.OnAfterExecuteSuccessfulResponse=function(){AddControlToPage(id,ts);};var tmpTableString="<table id=\""+ts+"\" style=\"display:none;\"></table>";InsertHTML(tmpTableString);Ajax.DoAjaxPostBack("addControl","true|"+id+"|"+ts,false,element,"Processing...",false,true,serverResponse);}else{__doPostBack("addControl","true|"+id);}}};MetafusePortalControlContainer.prototype.AddControlToPage=MetafusePortalControlContainer_AddControlToPage;function MetafusePortalControlContainer_AddControlToPage(id,ts){var table=GetElementById(ts);var row=GetElementById(id+"_ControlRow");row.parentNode.removeChild(row);var lt=GetElementById("lt");var tBodies=lt.getElementsByTagName("TBODY");var tBody=tBodies[0];tBody.appendChild(row);document.forms[0].removeChild(table);};MetafusePortalControlContainer.prototype.RemoveControl=MetafusePortalControlContainer_RemoveControl;function MetafusePortalControlContainer_RemoveControl(id){var row=GetElementById(id+"_ControlRow");UITools.ToggleDisplay(row,true);Ajax.DoAjaxPostBack("removeControl",id,false,null,"",false,false,null);};MetafusePortalControlContainer.prototype.GetRowContainingElement=MetafusePortalControlContainer_GetRowContainingElement;function MetafusePortalControlContainer_GetRowContainingElement(element,dontAlertWhenCannotFindElementOrParent){element=GetElementById(element);if(element){var parentNode=element;while(parentNode!=null){if(parentNode.nodeName=="TR"){return parentNode;}parentNode=parentNode.parentNode;}if(!dontAlertWhenCannotFindElementOrParent){alert("Unable to find the row the supplied element "+element.toString()+" is located in.");}}else{if(!dontAlertWhenCannotFindElementOrParent){alert("Unable to find the row the supplied element, because the supplied element is null is located in.");}}};