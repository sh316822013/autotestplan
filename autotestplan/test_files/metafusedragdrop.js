function MetafuseGenericDragObject(){this.Element;this.ElementShim;this.MouseStartX;this.MouseStartY;this.MouseX;this.MouseY;this.MouseStartPageXCoordinate;this.MouseStartPageYCoordinate;this.MousePageXCoordinate;this.MousePageYCoordinate;this.ElementStartPageXCoordinate;this.ElementStartPageYCoordinate;this.ElementPageXCoordinate;this.ElementPageYCoordinate;this.DisableScrollPageWhenDragging=false;this.DisableDragElement=false;this.MetafuseTableElementId=null;this.MetafuseSplitScreenElementId=null;this.MetafuseTableLeftPaneDiv=null;this.MetafuseTableRightPaneDiv=null;this.MetafuseTableHeight=null;this.zIndex=500;var self=this;this.OnClickFunction=null;this.OnDraggingMouseMoveMinimum=null;this.OnDraggingMouseMoveMinimumExceeded=false;this.IsTouchMove=false;this.IsPointerMove=false;this.IsMSGestureMove=false;this.OnBeforeClickFunction=null;this.IgnoreScrollPosition=false;this.OnAfterStopDrag=function(element){return true;};this.OnDragging=function(event,element){};this.StartDragOnClick=function(event,element,onclickfunction,metafuseTableElementId){this.OnClickFunction=onclickfunction;this.OnDraggingMouseMoveMinimumExceeded=false;if(this.OnDraggingMouseMoveMinimum==null){this.OnDraggingMouseMoveMinimum=5;}this.StartDrag(event,element,null,metafuseTableElementId);};this.StartDragAfterMouseMove=function(event,element,metafuseTableElementId){this.OnDraggingMouseMoveMinimumExceeded=false;if(this.OnDraggingMouseMoveMinimum==null){this.OnDraggingMouseMoveMinimum=5;}this.StartDrag(event,element,null,metafuseTableElementId);};this.ChangeX=function(){if(this.MouseStartX&&this.MouseX){return this.MouseStartX-this.MouseX;}return 0;};this.ChangeXAbs=function(){return Math.abs(this.ChangeX());};this.ChangeY=function(){if(this.MouseStartY&&this.MouseY){return this.MouseStartY-this.MouseY;}return 0;};this.ChangeYAbs=function(){return Math.abs(this.ChangeY());};this.HasMouseMoved=function(change){if(this.ChangeXAbs()>=change){return true;}else if(this.ChangeYAbs()>=change){return true;}return false;};this.DeterminePointerOrTouchMove=function(event){self.IsTouchMove=false;self.IsPointerMove=false;if(event.type.toString().indexOf("touch")>=0){self.IsTouchMove=true;}else if(event.type.toString().indexOf("pointer")>=0){self.IsPointerMove=true;}};this.ClearXYPoints=function(){self.MouseStartX=null;self.MouseStartY=null;self.MouseX=null;self.MouseY=null;self.MouseStartPageXCoordinate=null;self.MouseStartPageYCoordinate=null;self.MousePageXCoordinate=null;self.MousePageYCoordinate=null;self.ElementStartPageXCoordinate=null;self.ElementStartPageYCoordinate=null;self.ElementPageXCoordinate=null;self.ElementPageYCoordinate=null;};this.StartDragWatch=function(event){self.DeterminePointerOrTouchMove(event);self.ClearXYPoints();var x,y;if(self.IsTouchMove){x=event.touches[0].pageX;y=event.touches[0].pageY;}else{x=event.clientX;y=event.clientY;}self.MouseStartX=x;self.MouseStartY=y;self.MouseX=x;self.MouseY=y;if(document.attachEvent){document.attachEvent("onmousemove",self.DragWatch);document.attachEvent("onmouseup",self.StopDrag);document.attachEvent("onkeydown",self.DragStopEscapeKey);document.body.style.userSelect="none";document.body.onselectstart=function(event){event.cancelBubble=true;event.returnValue=false;return false;};}else if(document.addEventListener){var moveEvent="mousemove";var endEvent="mouseup";if(self.IsTouchMove){moveEvent="touchmove";endEvent="touchend";}else if(self.IsPointerMove){moveEvent="pointermove";endEvent="pointerup";document.style.touchAction="none";}document.addEventListener(moveEvent,self.DragWatch,true);document.addEventListener(endEvent,self.StopDrag,true);document.addEventListener("keydown",self.DragStopEscapeKey,true);if(document.body.style.MozUserSelect){document.body.style.MozUserSelect="none";}if(document.body.style.webkitUserSelect){document.body.style.webkitUserSelect="none";}}};this.StartDrag=function(event,element,elementShim,metafuseTableElementId){self.ClearXYPoints();this.OnDraggingMouseMoveMinimumExceeded=false;$('body').addClass("UnSelect");self.Element=null;self.MetafuseTableElementId=null;var x,y;if(metafuseTableElementId){self.MetafuseTableElementId=metafuseTableElementId;}if(element){self.Element=GetElementById(element);}else{self.Element=self.GetGenericDragDiv();}self.DeterminePointerOrTouchMove(event);if(self.IsTouchMove){x=event.touches[0].pageX;y=event.touches[0].pageY;self.MouseStartX=x;self.MouseStartY=y;self.MouseX=x;self.MouseY=y;x+=window.ScrollX;y+=window.scrollY;}else{x=event.clientX;y=event.clientY;self.MouseStartX=x;self.MouseStartY=y;self.MouseX=x;self.MouseY=y;if(window.scrollX){x+=window.scrollX;y+=window.scrollY;}else{y+=document.documentElement.scrollTop;y+=document.body.scrollTop;x+=document.documentElement.scrollLeft;x+=document.body.scrollLeft;}}self.MouseStartPageXCoordinate=x;self.MouseStartPageYCoordinate=y;self.MousePageXCoordinate=x;self.MousePageYCoordinate=y;if(self.Element!=null){if(self.OnDraggingMouseMoveMinimum==null){self.ElementStartPageXCoordinate=parseInt(UITools.GetPageXCoordinate(self.Element));self.ElementStartPageYCoordinate=parseInt(UITools.GetPageYCoordinate(self.Element));}else{self.ElementStartPageXCoordinate=x-25;self.ElementStartPageYCoordinate=y-10;}self.ElementPageXCoordinate=self.ElementStartPageXCoordinate;self.ElementPageYCoordinate=self.ElementStartPageYCoordinate;}if(isNaN(self.ElementStartPageXCoordinate)){self.ElementStartPageXCoordinate=0;}if(isNaN(self.ElementStartPageYCoordinate)){self.ElementStartPageYCoordinate=0;}if(!self.DisableDragElement&&self.Element!=null){self.Element.style.zIndex=parseInt(self.Element.style.zIndex)+parseInt(self.zIndex);}if(self.MetafuseTableElementId){var table=GetElementById(self.MetafuseTableElementId);if(table.parentNode.id.indexOf("_rightPaneDiv")>0){self.MetafuseTableRightPaneDiv=table.parentNode;self.MetafuseSplitScreenElementId=self.MetafuseTableRightPaneDiv.id.replace("_rightPaneDiv","");self.MetafuseTableLeftPaneDiv=GetElementById(self.MetafuseSplitScreenElementId+"_leftPaneDiv");}else if(table.parentNode.id.indexOf("_leftPaneDiv")>0){self.MetafuseTableLeftPaneDiv=table.parentNode;self.MetafuseSplitScreenElementId=self.MetafuseTableLeftPaneDiv.id.replace("_leftPaneDiv","");self.MetafuseTableRightPaneDiv=GetElementById(self.MetafuseSplitScreenElementId+"_rightPaneDiv");}self.MetafuseTableHeight=UITools.GetElementHeight(table);}if(document.attachEvent){document.attachEvent("onmousemove",self.Drag);document.attachEvent("onmouseup",self.StopDrag);document.attachEvent("onkeydown",self.DragStopEscapeKey);document.body.style.userSelect="none";document.body.onselectstart=function(event){event.cancelBubble=true;event.returnValue=false;return false;};}else if(document.addEventListener){var moveEvent="mousemove";var endEvent="mouseup";if(self.IsTouchMove){moveEvent="touchmove";endEvent="touchend";}else if(self.IsPointerMove){moveEvent="pointermove";endEvent="pointerup";document.style.touchAction="none";}document.addEventListener(moveEvent,self.Drag,true);document.addEventListener(endEvent,self.StopDrag,true);document.addEventListener("keydown",self.DragStopEscapeKey,true);if(document.body.style.MozUserSelect){document.body.style.MozUserSelect="none";}if(document.body.style.webkitUserSelect){document.body.style.webkitUserSelect="none";}}};this.DragWatch=function(event){var x,y;if(self.IsTouchMove){x=event.touches[0].pageX;y=event.touches[0].pageY;self.MouseX=x;self.MouseY=y;}else{x=event.clientX;y=event.clientY;}self.MouseX=x;self.MouseY=y;if(BrowserTools.IsInternetExplorer()){event.cancelBubble=true;event.returnValue=false;}else{if(self.IsTouchEvent){event.stopPropagation();}event.preventDefault();}if(self.OnDragging){self.OnDragging(event,self.Element,self);}};this.Drag=function(event){var x,y;if(self.IsTouchMove){x=event.touches[0].pageX;y=event.touches[0].pageY;self.MouseX=x;self.MouseY=y;}else{if(window.scrollX){x=event.clientX;y=event.clientY;self.MouseX=x;self.MouseY=y;x+=window.scrollX;y+=window.scrollY;}else{x=event.clientX;y=event.clientY;self.MouseX=x;self.MouseY=y;x+=document.documentElement.scrollLeft+document.body.scrollLeft;y+=document.documentElement.scrollTop+document.body.scrollTop;}}self.MousePageXCoordinate=x;self.MousePageYCoordinate=y;if(!self.DisableDragElement&&self.Element!=null){if(self.OnDraggingMouseMoveMinimum!=null&&self.OnDraggingMouseMoveMinimumExceeded==false){var xDelta=Math.abs(self.MouseStartPageXCoordinate-self.MousePageXCoordinate);var yDelta=Math.abs(self.MouseStartPageYCoordinate-self.MousePageXCoordinate);if(xDelta>self.OnDraggingMouseMoveMinimum||xDelta>self.OnDraggingMouseMoveMinimum){self.OnClickFunction=null;self.OnDraggingMouseMoveMinimum=null;self.OnDraggingMouseMoveMinimumExceeded=true;UITools.ShowAtXY(left,top,self.Element);}}else{self.OnDraggingMouseMoveMinimumExceeded=true;var left=(self.ElementStartPageXCoordinate+x-self.MouseStartPageXCoordinate);var top=(self.ElementStartPageYCoordinate+y-self.MouseStartPageYCoordinate);if(top<0){top=0;}self.Element.style.left=left+"px";self.Element.style.top=top+"px";self.ElementPageXCoordinate=left;self.ElementPageYCoordinate=top;}}if(self.MetafuseTableLeftPaneDiv||self.MetafuseTableRightPaneDiv){var divToScroll=self.MetafuseTableLeftPaneDiv;if(!divToScroll){divToScroll=self.MetafuseTableRightPaneDiv;}var scrollTop=divToScroll.scrollTop;if(!scrollTop){scrollTop=0;}var divTopY=UITools.GetPageYCoordinate(divToScroll);var divBottomY=divTopY+UITools.GetElementHeight(divToScroll);var yOver=(y+50)-divBottomY-scrollTop;var yUnder=y-(divTopY+50+scrollTop);if(yOver>0||yUnder<0){var scrollYBy=0;if(yOver>0){scrollYBy=yOver;}else if(yUnder<0){scrollYBy=yUnder;}scrollTop=scrollTop+scrollYBy;if(divToScroll.scrollTop!=scrollTop){divToScroll.scrollTop=scrollTop;if(self.MetafuseTableLeftPaneDiv){MetafuseSplitScreen_LeftPaneScrolling(self.MetafuseSplitScreenElementId);}else{MetafuseSplitScreen_RightPaneScrolling(self.MetafuseSplitScreenElementId);}}}}if(!self.DisableScrollPageWhenDragging&&!self.IgnoreScrollPosition){var scrollTop=UITools.GetScrollTop();var windowHeight=UITools.GetWindowHeight();var scrollLeft=UITools.GetScrollLeft();var windowWidth=UITools.GetWindowWidth();var yOver=(y+20)-(windowHeight+scrollTop);var yUnder=y-(scrollTop+20);var xOver=(x+20)-(windowWidth+scrollLeft);var xUnder=x-(scrollLeft+20);if(xOver>0||yOver>0||xUnder<0||yUnder<0){var scrollXBy=0;var scrollYBy=0;if(xOver>0){scrollXBy=xOver;}else if(xUnder<0){scrollXBy=xUnder;}if(yOver>0){scrollYBy=yOver;}else if(yUnder<0){scrollYBy=yUnder;}if(scrollXBy!=0||scrollYBy!=0){window.scrollBy(scrollXBy,scrollYBy);}}}if(BrowserTools.IsInternetExplorer()){event.cancelBubble=true;event.returnValue=false;}else{if(self.IsTouchEvent){event.stopPropagation();}event.preventDefault();}if(self.OnDragging){self.OnDragging(event,self.Element,self);}};this.DragStopEscapeKey=function(event){if(UITools.GetKeyDown(event)==27){$("body").removeClass("UnSelect");this.OnClickFunction=null;this.OnDraggingMouseMoveMinimum=null;this.OnDraggingMouseMoveMinimumExceeded=false;this.OnDragging=null;self.OnAfterStopDrag=function(element){return true;};var moveEvent="mousemove";var endEvent="mouseup";if(self.IsTouchMove){moveEvent="touchmove";endEvent="touchend";}RemoveEventHandlerFromElement(document,moveEvent,self.Drag,true);RemoveEventHandlerFromElement(document,moveEvent,self.DragWatch,true);RemoveEventHandlerFromElement(document,endEvent,self.StopDrag,true);RemoveEventHandlerFromElement(document,'onkeydown',self.DragStopEscapeKey,true);if(document.attachEvent){document.body.onuserselect=null;document.body.style.userSelect="";}else if(document.addEventListener){document.body.style.MozUserSelect="";document.body.style.webkitUserSelect="";}if(!self.DisableDragElement&&self.Element!=null){UITools.HideDivAndIFrame(self.Element);}document.body.style.cursor='default';}};this.StopDrag=function(){$("body").removeClass("UnSelect");self.OnDragging=null;var moveEvent="onmousemove";var endEvent="onmouseup";if(self.IsTouchMove){moveEvent="ontouchmove";endEvent="ontouchend";}RemoveEventHandlerFromElement(document,moveEvent,self.Drag,true);RemoveEventHandlerFromElement(document,moveEvent,self.DragWatch,true);RemoveEventHandlerFromElement(document,endEvent,self.StopDrag,true);RemoveEventHandlerFromElement(document,'onkeydown',self.DragStopEscapeKey,true);if(document.attachEvent){document.body.style.userSelect="";document.body.onselectstart=null;}else if(document.addEventListener){document.body.style.MozUserSelect="";document.body.style.webkitUserSelect="";}if(!self.DisableDragElement&&self.Element!=null){self.Element.style.zIndex=parseInt(self.Element.style.zIndex)-parseInt(self.zIndex);}var rtn=null;if(self.OnClickFunction!=null){if(self.OnBeforeClickFunction){self.OnBeforeClickFunction(this);}rtn=self.OnClickFunction();}else{rtn=self.OnAfterStopDrag(self);}this.OnClickFunction=null;this.OnDraggingMouseMoveMinimum=null;this.OnDraggingMouseMoveMinimumExceeded=false;self.OnAfterStopDrag=function(element){return true;};return rtn;};this.IsMouseOverElement=function(elementId,horizontalBuffer,verticalBuffer){var element=GetElementById(elementId);if(!horizontalBuffer){horizontalBuffer=0;}if(!verticalBuffer){verticalBuffer=0;}var over=false;if(element){var elementX=UITools.GetPageXCoordinate(element)-horizontalBuffer;var elementY=UITools.GetPageYCoordinate(element)-verticalBuffer;var elementXEnd=elementX+element.offsetWidth+horizontalBuffer;var elementYEnd=elementY+element.offsetHeight+verticalBuffer;if(elementX<=self.MousePageXCoordinate&&elementXEnd>=self.MousePageXCoordinate&&elementY<=self.MousePageYCoordinate&&elementYEnd>=self.MousePageYCoordinate){over=true;}}return over;};this.IsMouseOverElementTopHalf=function(elementId){var element=GetElementById(elementId);var elementOverYT=UITools.GetPageYCoordinate(element);var elementOverYB=elementOverYT+(element.offsetHeight/2);if(this.MousePageYCoordinate<elementOverYB){return true;}else{return false;}};this.IsElementOverElement=function(elementId,horizontalBuffer,verticalBuffer){var element=GetElementById(elementId);if(!horizontalBuffer){horizontalBuffer=0;}if(!verticalBuffer){verticalBuffer=0;}var over=false;if(element){var offsetWidth=element.offsetWidth;var offsetHeight=element.offsetHeight;if(element.tagName=="TR"&&BrowserTools.IsSafari()&&(offsetWidth==0||offsetHeight==0)){if(offsetHeight==0&&element.firstChild!=null&&element.firstChild.offsetHeight){offsetHeight=element.firstChild.offsetHeight;}if(offsetWidth==0&&element.lastChild&&element.lastChild.offsetWidth){offsetWidth=UITools.GetPageXCoordinate(element.lastChild)+element.lastChild.offsetWidth;}}var elementX=UITools.GetPageXCoordinate(element)-horizontalBuffer;var elementY=UITools.GetPageYCoordinate(element)-verticalBuffer;var elementXEnd=elementX+offsetWidth+horizontalBuffer;var elementYEnd=elementY+offsetHeight+verticalBuffer;if(elementX<=self.ElementPageXCoordinate&&elementXEnd>=self.ElementPageXCoordinate&&elementY<=self.ElementPageYCoordinate&&elementYEnd>=self.ElementPageYCoordinate){over=true;}}return over;};this.GetGenericDragDiv=function(innerHTML){var id="metafuseDragDropDragDiv";var div=GetElementById(id);if(div==null){var divText="";divText='<div id="'+id+'" class="DivMoving DropShadow" style="z-index:500;display:none;position:absolute;left:0;top:0;"></div>';UITools.InsertHTML(divText);div=GetElementById(id);}if(innerHTML==null){innerHTML="";}div.innerHTML=innerHTML;return div;};};