var client=null;var info=null;function UserMention_OnDelimiter(element){var obj=GetElementById(element);if(obj){if((obj.innerText!=undefined&&obj.innerText.indexOf("@")>=0)){UserMention_Populate(obj);}if(obj.value!=undefined&&obj.value.indexOf("@")>=0){UserMention_Populate(obj);}if((obj.innerText!=undefined&&obj.innerText.indexOf("#")>=0)){UserMention_Populate(obj);}if(obj.value!=undefined&&obj.value.indexOf("#")>=0){UserMention_Populate(obj);}}};function UserMention_Populate(element){element=GetElementById(element);client=new pi.Rest.MetafuseClient();info=client.get('/api/user/list-communicate',null,null,null,'name,AvatarHtml,Id');var people=[];$.each(info,function(index,value){var avatar='';if(value.AvatarHtml!=null){avatar=value.AvatarHtml;}else{var uIcon=Root+value.PhotoUrl;avatar='<img class=\'pi-mention-img\' src=\''+uIcon+'\' />';if(value.PhotoUrl==null||value.PhotoUrl==''){avatar="";}}people.push({name:value.Name,username:value.Name,image:avatar,id:value.Id});});$('#'+element.id).atwho({at:'@',data:people});};function UserMention_EnterToTab(element,event){element=GetElementById(element);if(element){if(event.keyCode==13&&($(".atwho-view").css("display")!='none'&&$(".atwho-view").css("display")!=undefined)){var e=$.Event("keydown",{keyCode:9});event.stopImmediatePropagation();event.preventDefault();$(element.id).trigger(e);return false;}}};